(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[129],{1007:function(e,t,i){"use strict";var s=i(0);var r=i(828);var n=[28,42,56,70];e.exports=r.extend({defaults:{route:"",offset:0,limit:n[0],page:1,totalItems:0,totalPages:0,pagerLimit:1,schema:{}},validation:{offset:{required:true,pattern:/^[0-9]\d*$/,min:0,fn:function e(t){if(t<0||this.get("totalItems")&&t>this.get("totalItems")){return"Invalid value for offset, given: "+t}return undefined}},page:{required:true,pattern:/^[1-9]\d*$/,min:1,fn:function e(t){if(this.get("totalPages")&&t>this.get("totalPages")){return"Invalid value for page, given: "+t}return undefined}}},getLimits:function e(){return n},getQueryParams:function e(){return this.pick(["limit","offset"])},initialize:function e(t){var i=t.page,s=t.offset;if(i){this.mutateOffsetByPage(i)}else if(s){this.mutatePageByOffset(s)}this.on("change",this.calculate)},parse:function e(t){return s.pick(t,s.keys(this.defaults))},calculate:function e(t){if(s.has(t.changed,"page")){this.mutateOffsetByPage(t.changed.page)}if(s.has(t.changed,"offset")||s.has(t.changed,"limit")){this.mutatePageByOffset(t.changed.offset)}this.attributes.totalPages=Math.ceil(parseFloat(this.get("totalItems")/this.get("limit")))},mutateOffsetByPage:function e(t){if(t===void 0){t=this.get("page")}this.attributes.offset=Math.max(parseInt(t,10)-1,0)*this.get("limit")},mutatePageByOffset:function e(t){if(t===void 0){t=this.get("offset")}this.attributes.page=Math.floor(parseInt(t/this.get("limit"),10))+1},getSchema:function e(){var t=this;if(!s.isEmpty(this.get("schema"))){return this.get("schema")}var i=function e(i){if(i<=0||i>t.get("totalPages")){return null}return t.getUrl({page:i})};return{current:this.getUrl(),buttons:{first:{href:i(this.validation.page.min),page:this.validation.page.min,active:this.get("page")!==this.validation.page.min},last:{href:i(this.get("totalPages")),page:this.get("totalPages"),active:this.get("page")!==this.get("totalPages")},prev:{href:i(this.getPrevPage()),page:this.getPrevPage(),active:this.hasPrevPage()},next:{href:i(this.getNextPage()),page:this.getNextPage(),active:this.hasNextPage()}}}},getUrl:function e(t){if(t===void 0){t={}}var i=Object.assign(this.getUrlParams(),this.serialize(),t);return this.app.makeUrl(i,this.getUrlQueryParams())},getUrlParams:function e(){},getUrlQueryParams:function e(){},hasNextPage:function e(t){if(t===void 0){t=this.get("page")}return t<this.get("totalPages")},hasPrevPage:function e(t){if(t===void 0){t=this.get("page")}return t>this.validation.page.min},getPrevPage:function e(){return Math.max(parseInt(this.get("page"),10)-1,1)},getNextPage:function e(){return Math.min(parseInt(this.get("page"),10)+1,this.get("totalPages"))},getNextOffset:function e(){var t=parseInt(this.get("offset"),10);var i=parseInt(this.get("limit"),10);return Math.min(t+i,this.get("totalItems"))}})},1029:function(e,t,i){"use strict";i(1504);var s=i(1505);var r=i(546);var n=i(549);e.exports=r.extend({name:"FolderPermissions",el:false,template:s,disableRemove:false,isMultipleSharing:false,events:{"click ._access":"onAccessClick","click ._remove":"onRemoveClick"},initialize:function e(){if(!this.model){throw new Error(this.name+" "+this.cid+": Permission model required!")}if(!this.folder){throw new Error(this.name+" "+this.cid+": Folder model required!")}},serialize:function e(){return{permList:this.isMultipleSharing?this.getListForMultipleSharing():this.getList()}},getListForMultipleSharing:function e(){return[{type:"access",name:"view",title:this.tr("Can View"),active:this.folder.hasAction("shareView")},{type:"access",name:"edit",title:this.tr("Can Edit"),active:this.folder.hasAction("shareEdit")}]},getList:function e(){var t=this.model.get("type");var i=this.model.get("permission");var s=this.folder.get("permission");var r=this.app.user.get("id")===this.folder.get("userId");var n=this.model.get("type")==="user"&&this.model.get("user").get("userId")===this.app.user.get("id");var a=!this.disableRemove&&t!=="link"&&(r||s==="edit"||n);var o=[];if(this.folder.hasAction("shareEdit")){o.push({type:"access",name:"view",title:this.tr("Can View"),active:i==="view"});o.push({type:"access",name:"edit",title:this.tr("Can Edit"),active:i==="edit"})}if(a){o.push({type:"remove",name:"remove",title:n?this.tr("Leave Collection"):this.tr("Remove")})}return o},onAccessClick:function e(t){t.stopPropagation();var i=t.currentTarget.dataset.name;if(this.isUserTryToDecreaseOwnAccess(i)){this.showConfirmationDialog(i)}else{this.changeCallback(i)}},onRemoveClick:function e(t){t.stopPropagation();this.removeCallback()},isUserTryToDecreaseOwnAccess:function e(t){if(this.isMultipleSharing){return false}return this.model.get("type")==="user"&&parseInt(this.model.get("user").get("userId"),10)===parseInt(this.app.user.get("id"),10)&&this.model.get("permission")==="edit"&&t==="view"},showConfirmationDialog:function e(t){var i=this;var s=new n({title:this.tr("Are you sure?"),message:this.tr("By changing sharing settings, you will no longer be able to edit this folder."),footer:[{label:this.tr("Yes"),hide:true,color:"blue",defaultAction:true,callback:function e(){return i.changeCallback(t)}},{label:this.tr("No"),hide:true}],destroyOnHide:true,app:this.app});s.show()},changeCallback:function e(){},removeCallback:function e(){}})},1044:function(e,t,i){"use strict";var s=i(0);var r=i(828);var n=i(1071);var a=r.extend({defaults:{limit:60,offset:0}});var o=i(1007);var l=r.extend({});e.exports=n.extend({storageKey:"pageable",endless:false,pending:false,byPageCache:{},modeIdToPageLinks:{},lastSyncOptions:{},getQueryParams:function e(){var t=s.result(this.filters,"getQueryParams");var i=s.result(this.pager,"getQueryParams");var r=s.result(this.sorting,"getQueryParams");return Object.assign(t,i,r)},initialize:function e(t,i){if(i===void 0){i={}}Object.assign(this,s.pick(i,["url","route","endless"]));this.initFilters(i.filters);this.initPager(i.pager);this.initSorting(i.sorting);this.listenTo(this.filters,"change",this.filtersChangeListener);this.listenTo(this.pager,"change",this.onPagerChange);this.listenTo(this.sorting,"change",this.onSortingChange);this.on({request:this.onCollectionRequest,sync:this.onCollectionSync,update:this.onCollectionUpdate,reset:this.onCollectionUpdate,sort:this.invalidateCaches})},initFilters:function e(t){if(t===void 0){t={}}if(t.cid){this.filters=t}else{this.filters=new a(t,{app:this.app})}},initPager:function e(t){var i=this;if(t===void 0){t={}}if(t.cid){this.pager=t}else{if(!this.endless){s.defaults(t,{limit:s.result(this.app.settings.get(this.storageKey),"limit")})}this.pager=new o(t,{app:this.app});if(t&&t.getUrlQueryParams){this.pager.getUrlQueryParams=function(){return t.getUrlQueryParams()}}}this.pager.getUrlParams=function(){return i.getQueryParams()}},initSorting:function e(t){if(t===void 0){t={}}if(t.cid){this.sorting=t}else{this.sorting=new l(t,{app:this.app})}},fetch:function e(t){if(this.pending){return false}var i=Object.assign({remove:!this.endless,reset:s.result(t,"reset",this.isEmpty()),page:this.pager.get("page")},t);if(this.endless){i.add=true}if(this.endless&&this.pager.get("page")<this.pager.previous("page")){i.at=0}return n.prototype.fetch.call(this,i)},serializePartial:function e(){var t=this;if(this.endless&&!s.result(this.lastSyncOptions,"reset")){return s.map(this.getCachedPageIds(this.lastSyncOptions.page),(function(e){return t.get(e).serialize()}))}return n.prototype.serialize.call(this)},filtersChangeListener:function e(t,i){var r=s.pick(t.changed,["limit","offset"]);if(!s.isEmpty(r)){this.setPager(r,Object.assign({pageAbleInnerSync:true},i))}if(!i.pageAbleInnerSync){this.resetCaches();this.onFiltersChange(t,i)}},onFiltersChange:function e(){},onPagerChange:function e(t,i){if(!i.pageAbleInnerSync&&(t.changed.page||t.changed.limit)&&!this.hasCachedPage(t.changed.page)){this.fetch(i)}},onSortingChange:function e(){},onCollectionRequest:function e(){this.pending=true;this.lastSyncOptions={}},onCollectionSync:function e(t,i,s){this.pending=false;this.lastSyncOptions=s},onCollectionUpdate:function e(){this.setPager({totalItems:this.totalItems});this.invalidateCaches()},resetCaches:function e(){this.modeIdToPageLinks={};this.byPageCache={}},invalidateCaches:function e(){this.resetCaches();if(this.endless){var t=Math.max(this.pager.get("limit"),1);for(var i=0;i<this.models.length;i+=1){var s=Math.ceil((i+1)/t);var r=this.models[i];this.modeIdToPageLinks[r.id]=s;if(this.byPageCache[s]){this.byPageCache[s].push(r.id)}else{this.byPageCache[s]=[r.id]}}}},hasCachedPage:function e(t){var i=this.byPageCache[+t];return i&&i.length===this.pager.get("limit")},getCachedPageIds:function e(t){return this.byPageCache[parseInt(t,10)]},getPageByItemId:function e(t){return this.modeIdToPageLinks[parseInt(t,10)]},getFilters:function e(t){return s.isArray(t)?this.filters.pick(t):this.filters.get(t)},setFilters:function e(){var t;return(t=this.filters).secureSet.apply(t,arguments)},getPager:function e(t){return s.isArray(t)?this.pager.pick(t):this.pager.get(t)},setPager:function e(){var t;return(t=this.pager).secureSet.apply(t,arguments)},getSorting:function e(t){return s.isArray(t)?this.sorting.pick(t):this.sorting.get(t)},setSorting:function e(){var t;return(t=this.sorting).secureSet.apply(t,arguments)},fetchPage:function e(t,i){this.setPager({page:t?parseInt(t,10):this.getPager("page")},i);if(!this.pager.hasChanged()){this.fetch(i)}},fetchPrevPage:function e(){if(!this.pending&&this.pager.hasPrevPage()){this.setPager({page:this.pager.getPrevPage()})}},fetchNextPage:function e(t){if(t===void 0){t={}}if(!this.pending&&this.pager.hasNextPage()){this.setPager({page:this.pager.getNextPage()},Object.assign({},t))}}})},1070:function(e,t,i){"use strict";var s=i(127);Object.assign(s.validators,{boolean:function e(t,i,s,r){if(typeof t!=="boolean"){return this.format("{0} must be boolean",this.formatLabel(i,r))}return undefined}});Object.assign(s.patterns,{email:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i});e.exports=s},1071:function(e,t,i){"use strict";function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);if(t)s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));i.push.apply(i,s)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};if(t%2){s(Object(i),true).forEach((function(t){n(e,t,i[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(i))}else{s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}}return e}function n(e,t,i){if(t in e){Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true})}else{e[t]=i}return e}var a=i(890);var o=i(828);e.exports=a.Collection.extend({model:o,constructor:function e(t,i){var s=this;if(i===void 0){i={}}this.app=i.app;this.on("destroy",(function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++){t[i]=arguments[i]}return s.trigger.apply(s,["sync"].concat(t))}));a.Collection.call(this,t,i)},clone:function e(t){return new this.constructor(this.models,{model:this.model,comparator:this.comparator},t)},getQueryParams:function e(){return{}},_prepareModel:function e(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++){i[s]=arguments[s]}var r=a.Collection.prototype._prepareModel.apply(this,i);r.app=this.app;return r},toPLAIN:function e(t){return this.models.map((function(e){return e.get(t||e.idAttribute)}))},serialize:function e(t){if(t===void 0){t={}}return this.models.map((function(e){return e.serialize(t)}))},toAPI:function e(){return{}},isBulkAllowed:function e(){return true},sortByOrder:function e(t,i){if(t===void 0){t=[]}if(i===void 0){i={}}this.models.sort((function(e,i){if(!t.includes(e.id)||!t.includes(i.id)){return 0}return t.indexOf(e.id)-t.indexOf(i.id)}));if(!i.silent){this.trigger("sort",this,i)}},promiseSync:function e(t,i,s){var n=this;if(s===void 0){s={}}return new Promise((function(e,a){var o=n.sync(t,i,r({},s,{success:function t(i){if(i.errors){return a(i.errors)}return e(i)},error:function e(t){a(t)}}));if(!o){a(new Error("There is no result returned"))}}))}})},1072:function(e,t,i){},1076:function(e,t,i){"use strict";var s=i(11);e.exports={initSocialButtons:function e(t){var i=this;var s=this.app.user.isLoggedIn()?"-"+this.convertBaseNumber(this.app.user.get("id")):"";this.$("._share-button").each((function(e,r){var n=r.getAttribute("data-social");var a=t.shareData.title||r.getAttribute("data-title");var o=t.shareData.description||r.getAttribute("data-description");var l=i.getCustomSocialRedirectUrl({socialSuffix:t.socialNameMap[n],refId:s,element:r});switch(n){case"facebook":r.href=i.app.makeUrl("facebookSharer",{query:{u:l,title:a,description:o,caption:i.app.host,picture:t.shareData.image}});break;case"twitter":r.href=i.app.makeUrl("twitterSharer",{query:{url:l,via:"depositphotos",text:a+" #stock #photo"}});break;case"pinterest":r.href=i.app.makeUrl("pinterestSharer",{query:{url:l,media:t.shareData.image,description:a}});break;case"vk":r.href=i.app.makeUrl("vkSharer",{query:{url:l,title:a,description:o,image:t.shareData.image}});break;default:r.href="";break}}))},convertBaseNumber:function e(t){return parseInt(t,10).toString(36)},getCustomSocialRedirectUrl:function e(t){if(this.getSocialRedirectUrl){return this.getSocialRedirectUrl(t)}return this.getDefaultSocialRedirectUrl(t)},getDefaultSocialRedirectUrl:function e(t){var i=this.convertBaseNumber(""+t.socialSuffix+this.model.get("id"));return s.urlFormat({protocol:this.app.parsedUrl.protocol,host:this.app.host,pathname:"/v/"+i+t.refId})},onShareButtonClick:function e(t){t.preventDefault();t.stopPropagation();var i=t.currentTarget;var s=t.currentTarget.getAttribute("data-width");var r=t.currentTarget.getAttribute("data-height");var n=(screen.height/2-r/2).toFixed(0);var a=(screen.width/2-s/2).toFixed(0);var o="\n\t\t\ttop="+n+",left="+a+",width="+s+",height="+r+",resizable=yes,\n\t\t\tscrollbars=no,status=yes,location=no";var l=window.open("about:blank",i.getAttribute("data-title"),o);l.location.href=i.href}}},1356:function(e,t,i){"use strict";var s=i(0);var r=i(28);var n=i(1471);e.exports=r.extend({url:"FolderPermissions",model:n,initialize:function e(){var t=this;this.cid=s.uniqueId("col");this.on("change",(function(e,i){if(i===void 0){i={}}if(i.observable){t.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:t.cid,folderId:e.get("folderId")})}}));this.on("update",(function(e,i){if(i===void 0){i={}}if(i.observable){t.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:t.cid,folderId:e.length?e.first().get("folderId"):0})}}))},parse:function e(t){return t?t.result:[]},findPermissionByEmail:function e(t){return this.find((function(e){return e.isMatchByEmail(t)}))}})},1402:function(e,t,i){"use strict";i(1493);var s=i(548);var r=i(1494);var n=i(546);var a=i(547);e.exports=n.extend({name:"FolderUsers",el:false,template:r,maxAvatars:5,events:{"mouseenter ._avatar-box":"onAvatarBoxMouseEnter","mouseleave ._avatar-box":"onAvatarBoxMouseLeave"},initialize:function e(){this.listenTo(this.collection,"change update reset",this.render)},prepareRender:function e(){this.users=this.collection.serialize().filter((function(e){return e.type!=="link"})).reverse();return!!this.users.length},serialize:function e(){var t=this.users.slice(0,this.maxAvatars);return{users:this.prepareUsers(t),moreCount:this.users.length-t.length,ownerId:this.model.get("userId")}},prepareUsers:function e(t){var i=this;return t.map((function(e){if(i.model.get("userId")===e.userId){e.title=i.tr("%s is the owner",e.fullName)}else if(e.permission==="edit"){e.title=i.tr("%s can edit",e.fullName)}else{e.title=i.tr("%s can view",e.fullName)}return e}))},onAvatarBoxMouseEnter:function e(t){t.preventDefault();this.setNotExistView("avatarTooltip",a,{params:s.darkTitle,classes:{tooltip_dark:true},content:new n({el:false,template:function e(){return t.currentTarget.getAttribute("data-title")}})});this.getView("avatarTooltip").show(t)},onAvatarBoxMouseLeave:function e(t){t.preventDefault();this.getView("avatarTooltip").remove()}})},1409:function(e,t,i){"use strict";var s=i(0);var r=i(23),n=r.defaultFolders;var a=i(32);var o=i(1477);var l=i(1410);e.exports=a.extend({defaults:{id:null,title:"",description:"",count:0,isPublic:true,isShared:false,permission:"view",userId:null,userName:"",ownerAvatar:"",ownerApprovedFilesCount:0,coverCropData:{},preferences:[],allowedActions:[],thumbs:[]},relations:{preferences:o,thumbs:l},validation:{count:{pattern:"digits"},isPublic:{boolean:true}},url:"Folder",lastSyncedAttrs:{},initialize:function e(){var t=this;this.on("sync",this.makeKostylCleanUpCoverCropData);this.on("change",(function(e,i){if(i===void 0){i={}}if(i.observable){t.app.observer.fire("Favorites:FolderChanged",{id:e.get("id"),cid:e.cid,changed:e.changed,options:i})}}))},makeKostylCleanUpCoverCropData:function e(t){if(t.get("preferences").get("coverItemId")){t.attributes.coverCropData={}}},parse:function e(t,i){if(t===void 0){t={}}if(t.errors){return{}}i.parser=null;var r=t.lightbox?t.lightbox:t;var n=s.pick(r,Object.keys(this.defaults));n.id=parseInt(r.lightboxId,10);n.userId=parseInt(r.userId,10);n.count=parseInt(r.count,10);n.isPublic=r.public;n.thumbs=r.items.filter((function(e){return!s.isEmpty(e)}));var a=this.experimentalTrueParseRelations(n,i);return Object.assign({},n,a)},serialize:function e(){var t=this.getFolderTitle(this.attributes.title);var i=!this.get("title")?"":this.app.makeUrl({route:"Folder",folderId:this.get("id"),folderName:this.get("title")});var s=this.get("userId")===this.app.user.get("id");var r=a.prototype.serialize.call(this);return Object.assign({},r,{title:t,link:i,isOwn:s})},toJSON:function e(){return this.serialize()},getFolderTitle:function e(t){return n.some((function(e){return e.label===t}))?this.app.tr(t):t},getQueryParams:function e(){return Object.assign({},this.attributes)},savePreference:function e(t,i){this.get("preferences").get(t).set({value:i});return this.save({},{wait:true})},hasAction:function e(t){return this.get("allowedActions").includes(t)}})},1410:function(e,t,i){"use strict";var s=i(117);var r=i(28);e.exports=r.extend({url:"Files",model:s,getQueryParams:function e(){return{ids:this.pluck("id")}},parse:function e(t,i){if(i===void 0){i={}}i.parser=i.parser||"parseFromSearch";var n=t.result||t;if(i.trueparse){return n.map((function(e){return s.prototype.parse(e,i)}))}return r.prototype.parse.call(this,n,i)}})},1419:function(e,t,i){"use strict";var s=i(741);var r=i(989).default;var n=i(1503);var a=i(548);var o=i(546);var l=i(1402);var c=i(1029);var u=i(547);e.exports=o.extend({name:"SharedUsers",el:false,template:n,listOnly:false,includeLink:false,opened:false,scrollPosition:0,events:{"click ._open-list":"onOpenListClick","click ._close-list":"onCloseListClick","click ._select-perm":"onSelectPermClick"},initialize:function e(){if(!this.model){throw new Error(this.name+": Folder model required!")}if(!this.collection){throw new Error(this.name+": FolderPermissions collection required!")}this.listenTo(this.collection,"change update reset",this.render)},prepareRender:function e(){this.setView("._users",new l({app:this.app,model:this.model,collection:this.collection}))},serialize:function e(){return{opened:this.opened,listOnly:this.listOnly,includeLink:this.includeLink,linkPermission:this.getLinkPermission(),usersList:this.getUsersList(),ownerId:this.model.get("userId")}},clientAfterRender:function e(){var t=this;if(this.opened){setTimeout((function(){return t.initPerfectScrollbar()}),0)}},initPerfectScrollbar:function e(){var t=this.$("._scroll");s.initialize(t.get(0),r);t.scrollTop(this.scrollPosition)},getLinkPermission:function e(){var t=this.collection.find((function(e){return e.get("type")==="link"}));return t?t.serialize():{}},getUsersList:function e(){if(!this.opened){return[]}return this.collection.serialize().filter((function(e){return e.type!=="link"})).reverse()},onOpenListClick:function e(t){t.preventDefault();this.opened=true;this.render()},onCloseListClick:function e(t){t.preventDefault();this.opened=false;this.render()},onSelectPermClick:function e(t){t.stopPropagation();var i=t.currentTarget.dataset.email;var s=this.collection.findPermissionByEmail(i);var r=this.getView("FolderPermissions");if(this.selectedModel&&this.selectedModel.cid===s.cid){if(r){r.toggle(t)}return}var n=this.app.user.get("id")===this.model.get("userId");var o=s.get("type")==="user"&&s.get("user").get("userId")===this.app.user.get("id");if(this.model.get("permission")==="view"&&!n&&!o){if(r&&r.isOpen()){r.hide()}return}this.selectedModel=s;this.setView("FolderPermissions",new u({params:a.FolderPermissions,content:new c({app:this.app,model:s,folder:this.model,changeCallback:this.selectPermissionCallback.bind(this),removeCallback:this.removePermissionCallback.bind(this)})}));this.getView("FolderPermissions").show(t)},saveScrollPosition:function e(){this.scrollPosition=this.$("._scroll").scrollTop()},selectPermissionCallback:function e(t){this.getView("FolderPermissions").hide();this.saveScrollPosition();this.selectedModel.updatePermission({permission:t})},removePermissionCallback:function e(){this.getView("FolderPermissions").hide();this.saveScrollPosition();this.selectedModel.deletePermission()}})},1471:function(e,t,i){"use strict";var s=i(0);var r=i(2);var n=i(32);e.exports=n.extend({url:"FolderPermission",defaults:{type:"",permission:"",folderId:null,link:null,value:null,user:{}},relations:{user:r.extend({defaults:{userId:null,username:"",email:"",firstName:"",lastName:"",avatar:"/_img/avatar-border-default-30.png"},initialize:function e(){var t=this;this.on("change:userId",(function(){t.attributes.userId=parseInt(t.attributes.userId,10)}))},parse:function e(t){if(t===void 0){t={}}var i=s.pick(t,Object.keys(this.defaults));i.userId=parseInt(i.userId,10);return i}})},parse:function e(t){if(t===void 0){t={}}if(t.errors){return{}}var i=s.pick(t,Object.keys(this.defaults));i.folderId=parseInt(i.folderId,10)||this.defaults.folderId;i.link=t.link||null;if(i.type==="email"){i.user={email:t.value}}if(i.type==="user"){i.user=t.value}return i},getQueryParams:function e(){var t=Object.assign({emitter:this.app.uid},this.attributes,this.get("user").attributes);if(this.get("type")==="link"){t.id=this.get("value")}if(this.get("type")==="user"){t.id=this.get("user").get("userId")}t.type=t.type==="link"?t.type:"user";return t},serialize:function e(){return Object.assign(this.get("user").serialize(),{userId:parseInt(this.get("user").get("userId"),10),permission:this.get("permission"),type:this.get("type"),link:this.get("link"),fullName:this.getFullName()})},getFullName:function e(){if(this.get("user").get("firstName").length){return(this.get("user").get("firstName")+" "+(this.get("user").get("lastName")||"")).trim()}return this.get("user").get("email")},isMatchByEmail:function e(t){if(this.get("type")==="link"){return false}return this.get("user").get("email")===t},updatePermission:function e(t){return this.save(t,{wait:true,observable:true})},deletePermission:function e(){var t=this;return this.sync("delete",this,{success:function e(){return t.destroy({observable:true})}})}})},1477:function(e,t,i){"use strict";var s=i(0);var r=i(2);var n=i(28);var a=r.extend({defaults:{name:"",label:"",value:null,editable:true,selector:""},idAttribute:"name",lastSyncedAttrs:{},initialize:function e(){var t=this;this.fakeNestedSaveLastSyncedAttrs();this.on("change",(function(e,i){if(i.storeAsLastSynced){t.fakeNestedSaveLastSyncedAttrs()}}))},saveLastSyncedAttrs:function e(t,i){if(!i.errors){this.lastSyncedAttrs=Object.assign({},this.lastSyncedAttrs,this.attributes)}},resetToLastSynced:function e(t,i){return this.set(t?s.pick(this.lastSyncedAttrs,t):this.attributes,i)},isChangedButNotSaved:function e(t){return this.get(t)!==this.lastSyncedAttrs[t]},isChangedButNotSavedValue:function e(){return this.isChangedButNotSaved("value")},resetToLastSyncedValue:function e(){return this.resetToLastSynced("value")},fakeNestedSaveLastSyncedAttrs:function e(){this.saveLastSyncedAttrs({},{})}});e.exports=n.extend({model:a,getPrefsAsHash:function e(){var t=this.serialize();var i={};t.forEach((function(e){i[e.name]=e.value}));return i}})},1493:function(e,t,i){},1494:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<div class="folder-users"><div class="folder-users__avatars">';var r=t.users;if(r){var n,a=-1,o=r.length-1;while(a<o){n=r[a+=1];s+='<div class="folder-users__avatar _avatar-box" data-title="'+i(n.title)+'">';if(n.type==="email"){s+='<span class="shared-users__link-box"><i class="icon icon-sharing-email"></i></span>'}else{s+='<span class="folder-users__avatar-box avatar-box avatar-box-m"><img class="folder-users__avatar-img avatar avatar-m" src="'+n.avatar+'" /></span>'}if(n.userId===t.ownerId){s+='<i class="folder-users__star icon icon-star-owner"></i>'}s+="</div>"}}s+="</div>";if(t.moreCount>0){s+='<div class="folder-users__more">+'+i(t.moreCount)+"</div>"}s+="</div>";return s}},1495:function(e,t,i){"use strict";var s=i(563);var r=i(1496);e.exports=s.extend({name:"ShareFolderModal",draggable:true,noBorder:true,showHeader:true,showTitle:false,fullScreen:true,destroyOnHide:true,options:{},modalClasses:"modal_share modal_with-poster",bodyClasses:"modal__body_share",footer:[],initialize:function e(){if(this.options.callback){this.onAfterHideCallback=this.options.callback}this.body=[new r({app:this.app,model:this.model,collection:this.collection,permissions:this.permissions,asyncPermissionsLoad:this.asyncPermissionsLoad,shareCallback:this.shareCallback.bind(this),hideCallback:this.hideCallback.bind(this)})];for(var t=arguments.length,i=new Array(t),n=0;n<t;n++){i[n]=arguments[n]}s.prototype.initialize.apply(this,i)},hideCallback:function e(){this.hide()},shareCallback:function e(){this.hide();this.app.observer.fire("Notification",{type:"success"})}})},1496:function(e,t,i){"use strict";i(1497);var s=i(823);var r=i(1498);var n=i(1499);var a=i(546);var o=i(578);var l=i(1500);var c=i(1513);var u=i(1076);var d=i(1356);var h=i(11);var f=6;var p=a.extend({name:"ShareFolder",el:false,template:r,props:{},activeTab:"email",asyncPermissionsLoad:false,events:{"click ._share-button":"onShareButtonClick"},initialize:function e(){this.props=s.ShareFolder(this.app);if(!this.model){throw new Error(this.name+" "+this.cid+": Folder model required!")}if(!this.asyncPermissionsLoad&&!this.permissions){throw new Error(this.name+" "+this.cid+": FolderPermissions collection required!")}if(!this.isMultipleSharing()&&this.asyncPermissionsLoad){this.permissions=new d([],{app:this.app});this.permissions.getQueryParams={folderId:this.model.get("id")};this.permissions.fetch({reset:true})}},prepareRender:function e(){var t=this;var i=this.isMultipleSharing();var s=this.isCompact()&&!this.linkSharingAllowed();var r={"._form":new l({app:this.app,folder:this.model,permissions:this.permissions,isMultipleSharing:i,shouldShowTitle:!s,shareCallback:this.shareCallback.bind(this)})};if(!s){this.setTabActive();r["._tabs"]=new o({name:"ShareFolderTabs",template:n,app:this.app,schema:this.getSchema(),preventDefaultAction:true,menuUnderline:true,changeTabCallback:function e(){return t.changeTabCallback()}})}if(!i&&this.emailSharingAllowed()){r["._link"]=new c({app:this.app,folder:this.model,permissions:this.permissions,hideCallback:this.hideCallback.bind(this)})}this.setViews(r)},serialize:function e(){var t=this.isCompact();var i=this.linkSharingAllowed();var s=t&&!i;return{isCompact:t,linkSharingAllowed:i,onlyEmailSharing:s,title:this.isMultipleSharing()?this.tr("Share Collections"):this.tr("Share Collection"),info:t?{}:this.model.serialize(),posterMap:this.getPosterMap(),emailSharingAllowed:this.emailSharingAllowed(),activeTab:this.activeTab}},clientAfterRender:function e(){if(!this.isCompact()){this.initSocialButtons({socialNameMap:{facebook:true,twitter:true,google:false},shareData:{title:this.model.get("title"),description:this.model.get("description"),image:this.collection.length?this.collection.first().makeThumb("huge"):""}})}},isMultipleSharing:function e(){return this.model instanceof Array&&this.model.length>1},isCompact:function e(){return typeof this.collection==="undefined"},emailSharingAllowed:function e(){return this.app.user.isLoggedIn()},linkSharingAllowed:function e(){return!this.isMultipleSharing()&&this.model.get("permission")==="edit"&&this.app.user.isLoggedIn()},setTabActive:function e(){var t=this.permissions.findWhere({type:"link"});var i=this.permissions.where({type:"user"});if(i.length<=1&&t&&t.get("permission")==="edit"){this.activeTab="link"}},getSchema:function e(){var t=[];var i=false;if(this.emailSharingAllowed()){i=true;t.push({key:"email",label:this.tr("Email"),active:this.activeTab==="email"})}if(this.linkSharingAllowed()){i=true;t.push({key:"link",label:this.tr("Link"),active:!i||this.activeTab==="link"})}if(!this.isCompact()){i=true;t.push({key:"social",label:this.tr("Social"),active:!i||this.activeTab==="social",enabled:this.props.socialTabEnabled})}return t},getPosterMap:function e(){var t={from:41};var i=[];var s=[];var r=[];if(!this.isCompact()){this.collection.first(f).forEach((function(e){s.push(e.makeThumb("bigWide"));r.push(e.get("id").toString().substr(-1)*2)}));for(var n=0;n<Math.max(Math.floor(s.length/2),1);n+=1){var a=t.from+r[n];var o=[{url:s[n*2],width:a}];var l=n*2+1;if(s[l]){o.push({url:s[l],width:100-a})}i.push({images:o})}}return i},changeTabCallback:function e(){this.app.observer.fire("Tooltip:GlobalHide",{cid:"all"});var t=this.findView("ShareFolderTabs").getActiveTab();this.$("._wrap").removeClass("active").filter("[data-tab="+t.get("key")+"]").addClass("active");this.activeTab=t.get("key")},getSocialRedirectUrl:function e(t){return h.urlFormat({protocol:"https:",host:this.app.host,pathname:"/f/"+this.model.get("id")+t.refId})},shareCallback:function e(){}});Object.assign(p.prototype,u);e.exports=p},1497:function(e,t,i){},1498:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<div class="share-modal';if(t.onlyEmailSharing){s+=" share-modal_by-email"}s+='">';if(!t.isCompact){s+='<div class="share-modal__left"><div class="share-modal__info-box"><span class="share-modal__info-text share-modal__info-text_title">'+i(t.info.title)+'</span><span class="share-modal__info-text share-modal__info-text_count">'+this.tr("%s Files",[t.info.count])+'</span></div><div class="share-modal__poster-wrap share-modal__poster-wrap_rows'+i(t.posterMap.length)+' _poster">';var r=t.posterMap;if(r){var n,a=-1,o=r.length-1;while(a<o){n=r[a+=1];s+='<div class="share-modal__poster-row share-modal__poster-row_count'+i(n.images.length)+'">';var l=n.images;if(l){var c,u=-1,d=l.length-1;while(u<d){c=l[u+=1];s+='<div class="share-modal__poster-cell"style="width: '+i(c.width)+"%;";if(c.url){s+=" background-image: url("+i(c.url)+");"}s+='"></div>'}}s+="</div>"}}s+="</div></div>"}s+='<div class="share-modal__right"><h2 class="share-modal__title">'+t.title+'</h2><div class="share-modal__tabs _tabs"></div><div class="share-modal__wrap">';if(t.emailSharingAllowed){s+='<div class="share-modal__form';if(t.activeTab==="email"){s+=" active"}s+=' _form _wrap" data-tab="email"></div>'}if(t.linkSharingAllowed){s+='<div class="share-modal__link';if(!t.emailSharingAllowed||t.activeTab==="link"){s+=" active"}s+=' _link _wrap" data-tab="link"></div>'}if(!t.isCompact){s+='<div class="share-modal__social';if(!t.emailSharingAllowed||t.activeTab==="social"){s+=" active"}s+=' _wrap" data-tab="social"><a class="share-modal__social-btn button-share-circle button-share-facebook _share-button"rel="nofollow" data-width="650" data-height="370" data-title="Facebook" data-social="facebook"><span class="button-share-circle-text">Facebook</span></a><a class="share-modal__social-btn button-share-circle button-share-twitter _share-button" rel="nofollow" data-width="730" data-height="420" data-title="Tweet" data-social="twitter"><span class="button-share-circle-text">Twitter</span></a></div>'}s+="</div></div></div>";return s}},1499:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<ul class="share-tabs share-tabs_count-'+i(t.scheme.length)+'">';var r=t.scheme;if(r){var n,a=-1,o=r.length-1;while(a<o){n=r[a+=1];if(!n.disabled){s+='<li class="share-tabs__item';if(n.active||n.pseudoActive){s+=" share-tabs__item_active _tab-active"}s+=' _tab" data-key="'+i(n.key)+'"><span class="share-tabs__link">'+i(n.label)+"</span></li>"}}}s+='<li class="share-tabs__menu-underline hidden _menu-underline"></li></ul>';return s}},1500:function(e,t,i){"use strict";i(1501);var s=i(0);var r=i(548);var n=i(1502);var a=i(556);var o=i(558);var l=i(1419);var c=i(1029);var u=i(547);var d=i(1506);var h=i(1507);var f=i(1512);var p=20;var v=[a.space,a.enter,a.semicolon,a.comma];var m=[";"];var g=[a.space,a.semicolon,a.comma];e.exports=o.extend({name:"ShareFolderForm",el:false,template:n,isMultipleSharing:false,shouldShowTitle:true,events:Object.assign({},o.prototype.events,{"click ._add-perm":"onAddPermClick"}),initialize:function e(){this.model=new d({foldersID:this.getSharingIds(),maxEmails:p},{app:this.app});this.shareEmailsCollection=new f([],{app:this.app});this.listenTo(this.model,{invalid:this.showErrors,sync:this.onSubmitForm,"change:permission":this.render})},prepareRender:function e(){if(!this.isMultipleSharing&&this.canSetPermission()){this.setView("._shared",new l({app:this.app,model:this.folder,collection:this.permissions}))}this.setMultiInput()},setMultiInput:function e(){var t=this;var i=function e(i){return t.fieldReset(t.$(i.currentTarget).closest("._errorHolder"))};this.setView("._share-multiple-emails",new h({app:this.app,collection:this.shareEmailsCollection,parseRecieverData:function e(i){return t.parseEmails(i)},onItemDeleteCallback:i,onItemFocusCallback:i,onItemBlurCallback:i,onReceiverFocusCallback:i,onReceiverBlurCallback:i,receiverCreateKeyCodes:v,receiverCreateKeys:m,itemEditExcludedKeys:g}))},serialize:function e(){return{formData:this.model.serialize(),canShareForEdit:this.canShareForEdit(),canSetPermission:this.canSetPermission(),permissionLabel:this.getPermissionLabel(),permissionType:this.model.get("permission"),shouldShowTitle:this.shouldShowTitle}},clientAfterRender:function e(){if(this.canSetPermission()){this.setView("AddFolderPermissions",new u({params:r.FolderPermissions,content:new c({app:this.app,model:this.model,folder:this.folder,disableRemove:true,isMultipleSharing:this.isMultipleSharing,changeCallback:this.selectPermissionCallback.bind(this)})}))}},getSharingIds:function e(){return this.isMultipleSharing?this.folder.map((function(e){return e.get("id")})):this.folder.get("id")},canSetPermission:function e(){if(!this.isMultipleSharing){return this.folder.get("permission")==="edit"}return this.folder.every((function(e){return e.get("permission")==="edit"}))},canShareForEdit:function e(){if(!this.isMultipleSharing){return this.folder.hasAction("shareEdit")}return this.folder.every((function(e){return e.hasAction("shareEdit")}))},getPermissionLabel:function e(){if(this.model.get("permission")==="edit"){return this.tr("Can Edit")}return this.tr("Can View")},onFieldFocusOut:function e(t){if(t.currentTarget.value.length){var i=t.currentTarget.name==="email"?this.$(t.currentTarget).closest("._errorHolder"):this.$(t.currentTarget).parent();this.fieldCorrect(i)}},onSubmitForm:function e(t,i){if(i&&i.errors instanceof Array){this.showSubmitError(i.errors[0].error_message)}},onAddPermClick:function e(t){t.preventDefault();this.getView("AddFolderPermissions").toggle(t)},showErrors:function e(t,i){var s=this;if(i===void 0){i={}}this.$("label:not(.field-box_correct) input, label:not(.field-box_correct) textarea").each((function(e){return s.fieldReset(s.$(e).parent())}));Object.keys(i).forEach((function(e){var t=i[e]instanceof Array?i[e][0]:i[e];var r=e==="emails"?s.$("._errorHolder"):s.$("input[name="+e+"], textarea[name="+e+"]").parent();s.fieldIncorrect(r,{errorMessage:t.length?s.tr(t):t})}))},showSubmitError:function e(t){if(t){var i=this.$("._submit-error");i.toggleClass("hidden",false);i.text(t)}},serializeForm:function e(){return{emails:this.getEmailsArray(),subject:this.$el.find("._share-subject").val()}},parseEmails:function e(t){var i=s.uniq(s.compact(t.split(/[\s,;]+/)));return i.map((function(e){return{value:e}}))},getEmailsArray:function e(){return s.pluck(this.shareEmailsCollection.serialize(),"value")},prepareSubmit:function e(){this.model.set({emails:this.getEmailsArray()})},submit:function e(){var t=this;this.model.save(this.serializeForm(),{wait:true,success:function e(){t.app.observer.fire("Favorites:FolderPermissionsChanged",{cid:"all",folderId:t.getSharingIds()});t.shareCallback()}})},selectPermissionCallback:function e(t){this.getView("AddFolderPermissions").hide();this.model.set({permission:t})},shareCallback:function e(){}})},1501:function(e,t,i){},1502:function(e,t,i){"use strict";e.exports=function e(t){var i='<form class="share-email">';if(t.shouldShowTitle){i+='<span class="share-email__title">'+this.tr("Invite people to collaborate via Email")+":</span>"}i+='<div class="share-email__field field-box input-box input-box-xxxl input-box-params';if(!t.canShareForEdit){i+=" share-email__field_no-perms"}i+=' _errorHolder"><div class="input-params-wrap"><span class="input-params-title">'+this.tr("To:")+'</span><div class="_emails-counter share-modal__emails-counter-box"></div><div class="multi-input-box _share-multiple-emails"></div><div class="cmp-option-select input-params-select"><div class="cmp-option-select-wrap _add-perm">';if(t.permissionType==="view"){i+='<i class="icon-folder-action-view cmp-option-select-icon"></i>'}if(t.permissionType==="edit"){i+='<i class="icon-folder-action-edit cmp-option-select-icon"></i>'}i+='<i class="cmp-option-select-arrow arrow arrow-bottom arrow-block-1"></i></div></div></div></div><div class="share-email__shared _shared"></div><button class="share-email__submit button button-xxl button-watery button-blue _submit" type="submit">'+this.tr("Share")+"</button></form>";return i}},1503:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<div class="shared-users';if(t.opened){s+=" shared-users_opened"}if(t.listOnly){s+=" shared-users_list-only"}s+='">';if(!t.listOnly){s+='<span class="shared-users__title">'+this.tr("Shared with:")+"</span>"}if(!t.opened){s+='<div class="shared-users__avatars _users _open-list"></div><i class="shared-users__icon arrow arrow-bottom arrow-block-1 _open-list"></i>'}else{if(!t.listOnly){s+='<i class="shared-users__close arrow arrow-top arrow-block-1 _close-list"></i>'}s+='<div class="shared-users__list-box _scroll"><ul class="shared-users__list">';if(t.includeLink){s+='<li class="shared-users__list-row shared-users__list-row_type"><div class="shared-users__user"><div class="shared-users__avatar"><span class="shared-users__link-box"><i class="icon icon-sharing-link"></i></span></div><span class="shared-users__user-email">'+this.tr("Link Sharing")+'</span><span class="shared-users__user-name">';if(t.linkPermission.permission==="edit"){s+=""+this.tr("Anyone with the link can edit")}else{s+=""+this.tr("Anyone with the link can view")}s+='</span></div><div class="shared-users__perm">';if(t.linkPermission.permission==="edit"){s+='<i class="icon icon-folder-action-edit"></i>'}else{s+='<i class="icon icon-folder-action-view"></i>'}s+="</div></li>"}var r=t.usersList;if(r){var n,a=-1,o=r.length-1;while(a<o){n=r[a+=1];if(n.userId===t.ownerId){s+='<li class="shared-users__list-row"><div class="shared-users__user"><div class="shared-users__avatar"><span class="shared-users__avatar-box avatar-box avatar-box-m"><img class="shared-users__avatar-img avatar avatar-m" src="'+n.avatar+'" /></span>';if(n.userId===t.ownerId){s+='<i class="shared-users__star icon icon-star-owner"></i>'}s+='</div><span class="shared-users__user-name">';if(n.firstName.length||n.lastName.length){s+=""+i(n.firstName)+" "+i(n.lastName)}else{s+=""+i(n.username)}s+='</span><span class="shared-users__user-email" title="'+i(n.email)+'">'+i(n.email)+'</span></div><div class="shared-users__perm"><span class="shared-users__creator">'+this.tr("Creator")+"</span></div></li>"}else{s+='<li class="shared-users__list-row shared-users__list-row_hoverable _select-perm"data-id="'+i(n.email)+'"data-email="'+i(n.email)+'"><div class="shared-users__user">';if(n.type==="email"){s+='<div class="shared-users__avatar"><span class="shared-users__link-box"><i class="icon icon-sharing-email"></i></span></div>'}else{s+='<div class="shared-users__avatar"><span class="shared-users__avatar-box avatar-box avatar-box-m"><img class="shared-users__avatar-img avatar avatar-m" src="'+n.avatar+'" /></span>';if(n.userId===t.ownerId){s+='<i class="shared-users__star icon icon-star-owner"></i>'}s+="</div>"}s+='<span class="shared-users__user-name">';if(n.firstName.length||n.lastName.length){s+=""+i(n.firstName)+" "+i(n.lastName)}else{s+=""+i(n.username)}s+='</span><span class="shared-users__user-email" title="'+i(n.email)+'">'+i(n.email)+'</span></div><div class="shared-users__perm">';if(n.permission==="edit"){s+='<i class="icon icon-folder-action-edit"></i>'}else{s+='<i class="icon icon-folder-action-view"></i>'}s+="</div></li>"}}}s+="</ul></div>"}s+="</div>";return s}},1504:function(e,t,i){},1505:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<ul class="folder-perm-tooltip">';var r=t.permList;if(r){var n,a=-1,o=r.length-1;while(a<o){n=r[a+=1];s+='<li class="folder-perm-tooltip__item folder-perm-tooltip__item_'+i(n.type)+" _"+i(n.type)+'" data-name="'+i(n.name)+'">';if(n.active){s+='<i class="folder-perm-tooltip__icon icon icon-ok"></i>'}s+='<span class="folder-perm-tooltip__title">'+i(n.title)+"</span></li>"}}s+="</ul>";return s}},1506:function(e,t,i){"use strict";var s=i(23),r=s.validationMessages;var n=i(0);var a=i(2);e.exports=a.extend({url:"ShareFolder",defaults:{folderID:null,rawEmails:"",emails:[],subject:"",type:"email",permission:"view",maxEmails:65535},validation:{emails:function e(t){var i=this;if(!t.length){return true}if(t.length>this.get("maxEmails")){return this.app.translator.tr(this.getValidationMessage("tooMuchEmails"),[this.get("maxEmails")])}var s=null;t.find((function(e){if(e.length<3){s=i.getValidationMessage("emailMin");return true}if(e.length>128){s=i.getValidationMessage("emailMax");return true}if(!i.isEmail(e)){s=i.getValidationMessage("multipleEmail");return true}return false}));return s},permission:{oneOf:["view","edit"]},type:{oneOf:["user","email"]}},isEmail:function e(t){var i=/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i;return i.test(t)},getValidationMessage:function e(t){return r.find((function(e){return e.key===t})).label},parse:function e(t){return n.pick(t,n.keys(this.defaults))},getQueryParams:function e(){return Object.assign({},this.attributes,{type:"user"})}})},1507:function(e,t,i){"use strict";i(1508);var s=i(741);var r=i(989).default;var n=i(1509);var a=i(556);var o=i(546);var l=i(1510);var c=3;var u=65535;e.exports=o.extend({name:"MultiInput",el:false,template:n,isReceiverInFocus:false,receiverCreateKeyCodes:[a.enter],receiverCreateKeys:[],itemEditExcludedKeys:[],events:{"focus ._multi-input-receiver":"onReceiverFocus","blur ._multi-input-receiver":"onReceiverBlur","keydown ._multi-input-receiver":"onReceiverKeyDown","input ._multi-input-receiver":"onReceiverInput","mousedown ._multi-input-content":"onMultiInputMousedown","click ._multi-input-content":"onMultiInputClick"},prepareRender:function e(){this.setViews({"._items-list":new l({collection:this.collection,onItemChangeCallback:this.onItemChangeCallback.bind(this),onItemDeleteCallback:this.onItemDeleteCallback.bind(this),onItemFocusCallback:this.onItemFocusCallback.bind(this),onItemBlurCallback:this.onItemBlurCallback.bind(this),setReceiverFocus:this.setReceiverFocus.bind(this),addedAfterRender:this.itemsAfterAddCallback.bind(this),removedAfterRender:this.itemsAfterRemoveCallback.bind(this),excludedKeys:this.itemEditExcludedKeys})})},clientAfterRender:function e(){this.perfectScrollbar=s;this.perfectScrollbar.initialize(this.$("._scroll").get(0),r)},onMultiInputMousedown:function e(t){if(t.currentTarget===t.target){t.preventDefault();t.stopPropagation()}},onMultiInputClick:function e(t){if(this.isReceiverInFocus){return}if(t.currentTarget===t.target){this.setReceiverFocus()}},onReceiverInput:function e(t){var i=this.$("._multi-input-receiver-meter");i.text(t.currentTarget.value);if(i.outerWidth()>0){this.$(t.currentTarget).outerWidth(i.outerWidth()+c).outerHeight(i.outerHeight())}else{this.$(t.currentTarget).removeAttr("style")}this.updateScrollbar()},onReceiverKeyDown:function e(t){if(this.createItemTriggered(t)){this.createItems(t)}if(t.keyCode===a.tab){this.onReceiverTabPress(t)}},createItemTriggered:function e(t){return this.receiverCreateKeyCodes.some((function(e){return e===t.keyCode}))||this.receiverCreateKeys.some((function(e){return e===t.key}))},createItems:function e(t){t.preventDefault();this.saveReceiverData(t);this.resetReceiver()},onReceiverTabPress:function e(t){if(!this.getReceiverData()){return}t.preventDefault();this.saveReceiverData(t);this.resetReceiver()},onReceiverFocus:function e(t){this.isReceiverInFocus=true;this.onReceiverFocusCallback(t)},onReceiverBlur:function e(t){this.isReceiverInFocus=false;this.saveReceiverData(t);this.resetReceiver();this.onReceiverBlurCallback(t)},saveReceiverData:function e(t){var i=this.getReceiverData();if(!i){return}this.addNewItemsToCollection(i)},resetReceiver:function e(){var t=this.getReceiver();t.setAttribute("style","");t.value="";this.$("._multi-input-receiver-meter").html("")},setReceiverFocus:function e(){this.getReceiver().focus()},getReceiver:function e(){return this.$("._multi-input-receiver")[0]},getReceiverData:function e(){var t=this.getReceiver(),i=t.value;if(i===""){return false}return this.parseRecieverData(i)},parseRecieverData:function e(t){return[{value:t}]},addNewItemsToCollection:function e(t){if(t===void 0){t=[]}var i=this.prepareItems(t);if(i.length){this.collection.add(i)}else{this.resetReceiver();this.scrollToReciever()}},prepareItems:function e(t){var i=this;return t.filter((function(e){return!i.collection.some((function(t){return t.get("value")===e.value}))}))},onItemDeleteCallback:function e(){},onItemFocusCallback:function e(){},onItemBlurCallback:function e(){},onReceiverFocusCallback:function e(){},onReceiverBlurCallback:function e(){},itemsAfterAddCallback:function e(){this.scrollToReciever()},itemsAfterRemoveCallback:function e(){this.updateScrollbar()},onItemChangeCallback:function e(){this.updateScrollbar()},scrollToReciever:function e(){this.updateScrollbar();this.$("._scroll").scrollTop(u)},updateScrollbar:function e(){s.update(this.$("._scroll").get(0))}})},1508:function(e,t,i){},1509:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<div class="multi-input"><div class="multi-input__content-wrapper _scroll"><div class="multi-input__content _multi-input-content"><span class="multi-input__receiver-meter _multi-input-receiver-meter"></span><div class="_items-list"></div><div class="_multi-input-receiver-box"><textarea class="multi-input__receiver _multi-input-receiver" type="text" autocomplete="off" placeholder="'+i(this.tr("Email"))+'"></textarea></div></div></div></div>';return s}},1510:function(e,t,i){"use strict";var s=i(548);var r=i(556);var n=i(1511);var a=i(546);var o=i(547);e.exports=a.extend({name:"MultiInputItem",el:false,template:n,excludedKeys:[],addedAfterRenderNeeded:false,removedAfterRenderNeeded:false,events:{"focus ._item-text":"onItemFocus","blur ._item-text":"onItemBlur","keydown ._item-text":"onItemtKeyDown","input ._item-text":"onItemtInput","mousedown ._item-delete":"onDeleteMouseDown","click ._item-delete":"onDeleteClick","mouseenter ._item-invalid":"showValidationTip","mouseleave ._item-invalid":"hideValidationTip"},initialize:function e(){this.listenTo(this.collection,"update reset",(function(e,t){var i=t.changes,s=i.added,r=i.removed;this.addedAfterRenderNeeded=!!s.length;this.removedAfterRenderNeeded=!!r.length;this.render()}));this.listenTo(this.collection,"change",this.onItemChangeCallback)},serialize:function e(){return{items:this.collection.serialize()}},clientAfterRender:function e(){this.setValidationTip();if(this.addedAfterRenderNeeded){this.addedAfterRender()}if(this.removedAfterRenderNeeded){this.removedAfterRender()}this.restoreFocus()},setValidationTip:function e(){this.setNotExistView("validationTip",o,{params:s.multiInputValidationTip,content:new a({el:false,template:function e(){return""}})})},showValidationTip:function e(t){var i=t.currentTarget.dataset.id;var s=this.collection.get(i),r=s.validationMessage,n=r===void 0?"":r;this.getView("validationTip").content.template=function(){return n};this.getView("validationTip").show(t)},hideValidationTip:function e(){this.getView("validationTip").hide()},onItemtKeyDown:function e(t){if(t.keyCode===r.enter){this.onItemEnterPress(t)}if(this.excludedKeys.some((function(e){return e===t.keyCode}))){t.preventDefault()}if(t.keyCode===r.tab){this.onItemtTabPress(t)}},onItemtInput:function e(t){this.streamChangesToModel(t)},streamChangesToModel:function e(t){var i=this.$(t.currentTarget).closest("._item");var s=i.attr("data-id");var r=this.collection.get(s);var n=this.$(t.currentTarget).html();r.set({value:n});r.validate();if(r.isValid()){this.getView("validationTip").hide()}i.toggleClass("_item-invalid multi-input-item_invalid",!r.isValid())},onItemEnterPress:function e(t){t.preventDefault();this.itemInputAction(t);this.setReceiverFocus()},onItemtTabPress:function e(t){var i=this.$(t.currentTarget).html();if(i===""){this.focusStats={itemIndex:this.$(t.currentTarget).closest("._item").index(),cursorMoveDirection:t.shiftKey?"back":"forward"}}},restoreFocus:function e(){if(this.focusStats){var t=this.focusStats,i=t.itemIndex,s=t.cursorMoveDirection;var r=s==="forward"?i:i-1;this.$("._item").eq(r).find("._item-text").focus();this.focusStats=null}},onItemFocus:function e(t){this.onItemFocusCallback(t)},onItemBlur:function e(t){this.itemInputAction(t);this.onItemBlurCallback(t)},itemInputAction:function e(t){var i=this.$(t.currentTarget);var s=i.html();var r=i.closest("._item").attr("data-id");if(s===""){this.removeItemInCollection(r);return}this.changeItemInCollection(r,{value:s})},onDeleteMouseDown:function e(t){t.preventDefault()},onDeleteClick:function e(t){t.preventDefault();this.deleteItem(t)},deleteItem:function e(t){var i=this.$(t.currentTarget).closest("._item").attr("data-id");this.removeItemInCollection(i);this.hideValidationTip();this.onItemDeleteCallback(t)},changeItemInCollection:function e(t,i){if(i===void 0){i={}}this.collection.get(t).set(i)},removeItemInCollection:function e(t){this.collection.remove(t)},onItemDeleteCallback:function e(){},onItemChangeCallback:function e(){},onItemFocusCallback:function e(){},onItemBlurCallback:function e(){},addedAfterRender:function e(){},removedAfterRender:function e(){}})},1511:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s="<div>";var r=t.items;if(r){var n,a=-1,o=r.length-1;while(a<o){n=r[a+=1];s+='<span class="multi-input-item _item';if(n.isValid===false){s+=" multi-input-item_invalid _item-invalid"}s+='" data-id="'+i(n.id)+'"><span class="multi-input-item__text _item-text" contenteditable="true">'+i(n.value)+'</span><i class="multi-input-item__delete _item-delete"></i></span>'}}s+="</div>";return s}},1512:function(e,t,i){"use strict";var s=i(23),r=s.validationMessages;var n=i(2);var a=i(28);e.exports=a.extend({model:n.extend({defaults:{value:""},initialize:function e(){var t=this;this.on("add",(function(e,i,s){var r=t.validate();if(r){e.validationMessage=t.getValidationMessage(r)}}))},validation:{value:[{required:true,msg:r.find((function(e){return e.key==="required"})).label},{minLength:3,msg:r.find((function(e){return e.key==="emailMin"})).label},{maxLength:128,msg:r.find((function(e){return e.key==="emailMax"})).label},{pattern:"email",msg:r.find((function(e){return e.key==="email"})).label}]},serialize:function e(){return Object.assign({},this.attributes,{id:this.cid,isValid:this.isValid()})},getValidationMessage:function e(t){return t&&t.value||null}})})},1513:function(e,t,i){"use strict";var s=i(548);var r=i(1514);var n=i(558);var a=i(1029);var o=i(547);e.exports=n.extend({name:"ShareLinkForm",el:false,template:r,events:Object.assign({},n.prototype.events,{"click ._done":"onDoneClick","click ._add-perm":"onAddPermClick","click ._link-field":"onLinkFieldClick","click ._link-copy":"onLinkCopyClick"}),initialize:function e(){var t=this;this.listenTo(this.permissions,{"change:permission":function e(i){if(i.get("type")==="link"){t.render()}},update:this.render,reset:this.render})},prepareRender:function e(){this.model=this.permissions.findWhere({type:"link"});return typeof this.model!=="undefined"},serialize:function e(){return{canShareForEdit:this.canShareForEdit(),sharedLink:this.getSharedLink(),permissionLabel:this.getPermissionLabel()}},clientAfterRender:function e(){if(!this.model){return}this.setView("AddFolderPermissions",new o({params:s.FolderPermissions,content:new a({app:this.app,model:this.model,folder:this.folder,changeCallback:this.selectPermissionCallback.bind(this)})}))},canShareForEdit:function e(){return this.folder.hasAction("shareEdit")},getPermissionLabel:function e(){if(this.model.get("permission")==="edit"){return this.tr("Can Edit")}return this.tr("Can View")},onDoneClick:function e(){this.hideCallback()},onAddPermClick:function e(t){t.preventDefault();this.getView("AddFolderPermissions").toggle(t)},onLinkFieldClick:function e(t){t.currentTarget.select()},onLinkCopyClick:function e(){var t=this.$("._link-field").get(0);t.select();try{if(document.execCommand("copy")){this.app.observer.fire("Notification",{type:"success",description:this.tr("Link copied to the clipboard.")})}}catch(i){}t.selectionStart=-1;t.selectionEnd=-1},getSharedLink:function e(){return this.model.get("link")||this.app.makeUrl({route:"Folder",folderId:this.folder.get("id"),folderName:this.folder.get("title")},{absolute:true})},selectPermissionCallback:function e(t){this.model.updatePermission({permission:t});this.getView("AddFolderPermissions").hide()},hideCallback:function e(){}})},1514:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<form class="share-link';if(!t.canShareForEdit){s+=" share-link__no-perms"}s+='"><form class="share-link"><span class="share-link__title">'+this.tr("Collaborate by sharing link")+':</span><div class="share-link__field field-box input-box input-box-xxxl input-box-params"><div class="input-params-wrap"><input class="input input-xxxl _link-field" type="text" name="link" value="'+i(t.sharedLink)+'" autocomplete="off" readonly /><div class="input-params-select"><span class="input-action-wrap _link-copy"><span class="input-action">'+this.tr("Copy link")+'</span></span></div></div></div><div class="share-link__perm"><div class="share-link__perm-title">'+this.tr("Users with the link")+':</div><div class="cmp-option-select share-link__perm-select"><div class="cmp-option-select-wrap _add-perm"><span class="cmp-option-select-value">'+i(t.permissionLabel)+'</span><i class="cmp-option-select-arrow arrow arrow-bottom arrow-block-1"></i></div></div></div><button class="share-link__done button button-xxl button-watery button-blue _done">'+this.tr("Done")+"</button></form>";return s}},1591:function(e,t,i){"use strict";(function(e){i(1838);var t=i(548);var s=i(738).spinner;var r=i(1839);var n=i(737);var a=i(546);var o=i(547);var l=i(24),c=l.safeChain;var u=i(1840);var d=i(1697);var h=i(9),f=h.getLogger;var p=f(e);e.exports=a.extend({name:"FoldersSelect",el:false,template:r,selectableGroup:false,excludeActive:false,onlyEditable:false,containersOnly:false,selected:null,events:{click:"onClick"},initialize:function e(){this.listenTo(this.activeFolder,{destroy:this.handleFoldersRemove,sync:this.handleFoldersSync,"change:count":this.handleFoldersSync,"change:id":this.render});this.listenTo(this.folders,{remove:this.handleFoldersRemove,sync:this.handleFoldersSync,add:this.handleFoldersAdd});this.listenTo(this.app.observer,{"Favorites:RemoteFolderChanged":this.handleRemoteFolderChanged});var t={page:1,limit:100};this.ownFolders=new d([],{app:this.app,endless:true,filters:{permission:["owner"]},pager:t});this.sharedFolders=new d([],{app:this.app,endless:true,filters:{permission:this.onlyEditable?["edit"]:["edit","view"]},pager:t});this.fetchFolders(true)},serialize:function e(){var t=this.getSelectedFolder();var i={title:this.tr(this.app.user.isLoggedIn()?"My Folders":"My Photos"),isShownCounter:this.app.user.isLoggedIn()};if(this.state&&this.state.isEmptyFoldersMode()||!this.app.user.isLoggedIn()){return{emptyFolder:i,className:this.className,containersOnly:this.containersOnly}}if(this.state&&!this.state.isFilesMode()){var s=this.state.get("folderID")==="owner";var r=s?this.ownFolders.getPager("totalItems"):this.sharedFolders.getPager("totalItems");return{emptyFolder:i,className:this.className,folder:{isOwn:s,count:r,title:this.state.getFoldersGroupTitle()},containersOnly:this.containersOnly}}var n=t&&t.get("id")?Object.assign(t.serialize(),{isOwn:t.get("userId")===parseInt(this.app.user.get("id"),10),color:this.getFolderColor()}):null;return{emptyFolder:i,className:this.className,folder:n,containersOnly:this.containersOnly}},clientAfterRender:function e(){var i={app:this.app,active:this.getActiveFoldersIds(),selected:this.getSelectedFolder(),ownFolders:this.ownFolders,sharedFolders:this.sharedFolders,excludeActive:this.excludeActive,selectableGroup:this.selectableGroup,onSelect:this.onSelectedChange.bind(this),isGranted:this.isGranted.bind(this),onGroupClickCallback:this.onGroupClickCallback.bind(this)};var s=t.FoldersList;if(this.containersOnly){s.templatePosition="bl";s.templateOffset={top:0,left:-15}}this.setView("FoldersSelectOptionsToolTip",new o({name:"FoldersSelectOptionsToolTip",params:s,classes:{"tooltip_extra-shadow":true},content:new u(i)}));this.showLoading()},fetchFolders:function e(t){var i=this;if(t===void 0){t=false}Promise.all([this.ownFolders.fetch({reset:true}),this.sharedFolders.fetch({reset:true})]).then((function(){return i.render()})).catch((function(){p.warn("Can not get folders for select.");if(t){i.fetchFolders()}}))},handleFoldersSync:function e(t){var i=this.getFoldersByModel(t).get(t.get("id"));if(i){i.set(t.serialize())}this.render()},handleFoldersRemove:function e(t){var i=this.getFoldersByModel(t);i.totalItems-=1;i.remove(t);this.render()},handleFoldersAdd:function e(t,i,s){var r=s.created;if(r){this.ownFolders.totalItems+=1;this.ownFolders.add(t,{at:0})}},handleRemoteFolderChanged:function e(t){var i=t.id;var s=this.getFolder(i);if(s){s.fetch()}},getFoldersByModel:function e(t){return this[t.get("userId")===this.app.user.get("id")?"ownFolders":"sharedFolders"]},showLoading:function e(){var t=this.ownFolders.pending&&this.sharedFolders.pending;if(!this.spinner){this.spinner=new n(s)}this.$el.toggleClass("is-fetching",t);this.spinner[t?"spin":"stop"](this.$el.get(0))},getFolder:function e(t){return this.ownFolders.get(t)||this.sharedFolders.get(t)},getFolderColor:function e(){var t=this;var i=c((function(){return t.getSelectedFolder().get("preferences").get("folderViewColor").get("value")}),"");return i||"696969"},getSelectedFolder:function e(){var t=this;var i=this.selected?this.getFolder(this.selected.id):null;if(i){return i}var s=this.getActiveFoldersIds();var r=parseInt(this.app.user.get("id"),10);var n=function e(i){var n=!s.includes(i.get("id"));var a=i.get("userId")===r||i.get("permission")==="edit";return t.excludeActive&&n&&t.onlyEditable&&a};return this.ownFolders.find(n)||this.sharedFolders.find(n)},onClick:function e(t){if(!this.ownFolders.length&&!this.sharedFolders.length){return}this.getView("FoldersSelectOptionsToolTip").toggle(t)},getActiveFoldersIds:function e(){var t=this.getActiveFolder();if(!t){return[]}if(t instanceof Array){return t.map((function(e){return e.get("id")}))}return[t.get("id")]},onSelectedChange:function e(t){this.getView("FoldersSelectOptionsToolTip").hide();if(!this.isGranted("auth")){return}var i=parseInt(t,10);this.selected=this.getFolder(i);this.onFoldersChange(this.selected);this.render()},onGroupClickCallback:function e(t){if(!this.isGranted("auth")){this.getView("FoldersSelectOptionsToolTip").hide();return}if(this.selectableGroup){this.state.set({folderID:t})}else{this.getView("FoldersSelectOptionsToolTip").onTargetPosition()}},serializeForm:function e(){var t=this.getSelectedFolder();return{folder:t.get("id")}},getActiveFolder:function e(){},onFoldersChange:function e(){}})}).call(this,i(5)(e))},1592:function(e,t,i){"use strict";(function(e){var t=i(17);var s=i(9),r=s.getLogger;var n=r(e);var a=i(1409);var o=i(1846);var l=i(1754);var c=i(1848);var u=i(1849);var d=i(1495);var h=i(1755);var f=i(1756);var p=i(1699);var v={EmptySelectionFolders:o,CreateFolder:l,EditFolder:c,DeleteFolder:u,ShareFolder:d,MoveFiles:h,DeleteFiles:f,CopyFiles:p};var m=function e(i){if(i instanceof t.Model){return[i.get("id")]}if(i instanceof Array){return i.map((function(e){return e.get("id")}))}return[]};var g=function e(t,i){return new v[t](Object.assign({destroyOnHide:true},i))};e.exports={createFolder:function e(t,i){return g("CreateFolder",{app:t,model:new a({},{app:t})}).nativePromiseShow().then((function(e){return i.createFolder(e)})).then((function(e){if(e.get("isPublic")){t.observer.broadcast("Track:UE:Folders:CreatePublicPopup")}else{t.observer.broadcast("Track:UE:Folders:CreatePopup")}})).catch((function(e){return e&&n.error("Can't create folder. Error: "+e)}))},editFolder:function e(t,i){g("EditFolder",{app:t,model:i}).nativePromiseShow().then((function(e){return i.promiseSave(e,{wait:true,observable:true})})).then((function(){t.observer.fire("Notification",{type:"success"});t.observer.broadcast(i.get("isPublic")?"Track:UE:Folders:EditPublicPopup":"Track:UE:Folders:EditPopup")})).catch((function(e){return e&&n.error("Can't edit folder. Error: "+e)}))},moveFolders:function e(t){var i=this;if(t===void 0){t={}}var s=t,r=s.app,a=s.folders,o=s.foldersToMove,l=s.isGranted,c=l===void 0?function(){}:l;var u=m(o);return g("MoveFiles",{app:r,folders:a,getActiveFolder:function e(){return o},isGranted:c}).nativePromiseShow().then((function(e){return i.moveFoldersWithoutModal(r,a,u,e.folder)})).catch((function(e){return e&&n.error("Can't move folders. Error: "+e)}))},moveFoldersWithoutModal:function e(t,i,s,r){return i.moveFolders({source:s,target:r}).then((function(){i.fetch({reset:true});t.observer.fire("Notification",{type:"success"});t.observer.broadcast("Track:UE:Folders:Move")}))},copyFolders:function e(t){var i=t.app,s=t.folders,r=t.foldersToCopy,n=t.isGranted,a=n===void 0?function(){}:n;var o=r instanceof Array?r:[r];return g("CopyFiles",{app:i,getActiveFolder:function e(){return r},isGranted:a}).nativePromiseShow().then((function(e){return s.copyFolders({source:o.map((function(e){return e.get("id")})),target:e.folder})})).then((function(e){s.fetch({reset:true});i.observer.fire("Favorites:RemoteFolderChanged",{id:e.target});i.observer.fire("Notification",{type:"success"})})).catch((function(e){return e&&i.observer.fire("Notification",{type:"error"})}))},addToCart:function e(t,i,s){var r=m(s);i.addToCart(r).then((function(){t.observer.fire("Notification",{type:"success"});t.store.get("CartIndicator").fetch()}))},shareFolders:function e(t,i,s,r){var n=this;var a=i instanceof Array&&i.length===1?i[0]:i;if(r||a instanceof Array){this.callShareFolderModal(t,a,s,r);return}a.fetch({getQueryParams:{thumbsSize:"thumb",thumbsLimit:6}}).then((function(){n.callShareFolderModal(t,a,s,a.get("thumbs"))}))},callShareFolderModal:function e(t,i,s,r){g("ShareFolder",{app:t,model:i,permissions:s,collection:r,asyncPermissionsLoad:!s}).show();t.observer.broadcast("Track:UE:Folders:SharePopup")},removeFolders:function e(t,i){var s=i instanceof Array?i:[i];return g("DeleteFolder",{app:t}).nativePromiseShow({model:s.length===1?s[0]:s}).then((function(){var e=s.map((function(e){return e.destroy()}));Promise.all(e).then((function(){return t.observer.fire("Notification",{type:"success"})})).catch((function(){return t.observer.fire("Notification",{type:"error"})}));t.observer.broadcast("Track:UE:Folders:DeletePopup")}))},callModal:function e(){return g.apply(void 0,arguments)}}}).call(this,i(5)(e))},1651:function(e,t,i){"use strict";var s=i(0);var r=i(120);var n=function(){function e(e,t){var i=this;this.field=r(e);this.holder=null;this.options=s.extend({mode:"count",holder:"parent",min:0,max:0,prefix:"",format:"%count%"},t);this.createIndicator();if(this.options.max>0){this.field.attr("maxlength",this.options.max)}this.field.on("input",(function(){return i.count()}));this.count()}var t=e.prototype;t.createIndicator=function e(){if(typeof this.options.holder==="object"){this.holder=this.options.holder}else if(this.options.holder==="parent"){this.holder=this.field.parent()}else{this.holder=r(this.options.holder)}this.indicator=r("<i />",{class:"field-counter"});this.holder.append(this.indicator)};t.count=function e(){var e=this.field.val().length;if(this.options.mode==="countdown"){e=this.options.max-e}var t=this.options.format.replace("%count%",e).replace("%max%",this.options.max).replace("%prefix%",this.options.prefix);this.indicator.text(t);if(e>this.options.max||e<this.options.min||this.options.mode==="countdown"&&e<0){this.field.trigger("incorrect");this.indicator.addClass("red")}else{this.field.trigger("reset");this.indicator.removeClass("red")}};return e}();e.exports=function(e,t){e.each((function(e,i){new n(i,t)}))}},1697:function(e,t,i){"use strict";var s=i(1044);var r=i(1753);e.exports=s.extend({url:"Folders",model:r,experimentalTrueParse:function e(t,i){var s=t.lightboxes,n=s===void 0?[]:s,a=t.count,o=t.stats,l=o===void 0?{}:o;if(i===void 0){i={}}this.totalItems=parseInt(a,10);i.parse=false;i.trueparse=true;return n.map((function(e){return r.prototype.parse(e,i)}))},parse:function e(t,i){return this.experimentalTrueParse(t,i)},createFolder:function e(t){var i=this;if(t===void 0){t={}}var s=new r(t,{app:this.app});return s.promiseSave({},{wait:true}).then((function(){return i.add(s,{at:0,created:true})}))},updateFolder:function e(t,i,s){return this.get(t).save(i,Object.assign({wait:true,observable:true},s))},deleteFolder:function e(t){return this.get(t).destroy()},deleteFolders:function e(t){var i=this;return t.forEach((function(e){return i.deleteFolder(e)}))},addToCart:function e(t){var i=this;return this.promiseSync("update",this,{url:"CartFolderFiles",getQueryParams:{folderId:t}}).then((function(){return i.trigger("sync",i)}))},moveFolders:function e(t){var i=this;return this.promiseSync("update",this,{url:"MoveFolderFiles",getQueryParams:t}).then((function(){return i.trigger("sync",i)}))},copyFolders:function e(t){var i=this;return this.promiseSync("update",this,{url:"CopyFolderFiles",getQueryParams:t}).then((function(){i.trigger("sync",i);return t}))},isPageSetAndCorrect:function e(){if(this.app.queryParams.page&&!this.pager.hasNextPage(+this.app.queryParams.page)){this.pager.set("totalItems",this.totalItems);return this.pager.getUrl({page:this.pager.get("totalPages")})}return null}})},1698:function(e,t,i){"use strict";var s=i(0);var r=i(1847);var n=i(558);var a=i(1651);e.exports=n.extend({name:"EditFolderForm",template:r,clientAfterRender:function e(){a(this.$("._counter"),{mode:"countdown",max:50})},serializeForm:function e(){return{title:s.escape(this.$el.find("[name=title]").val().trim())}},serialize:function e(){return this.model.serialize()}})},1699:function(e,t,i){"use strict";var s=i(48);var r=i(546);var n=i(549);var a=i(1591);e.exports=n.extend({name:"CopyFiles",initialize:function e(){var t=this;this.title=s.CopyFilesTitle;this.body=function(){return new r({className:"fav-modal",views:{"":[new r({tagName:"p",className:"modal__text modal__text_indent",template:function e(){return t.tr(s.CopyFilesMessage)+":"}}),new a({app:t.app,className:"fav-modal__select fav-modal__select_rounded fav-modal__select_large",getActiveFolder:t.getActiveFolder,excludeActive:true,onlyEditable:true,isGranted:t.isGranted.bind(t)})]}})};this.footer=[{label:s.CancelBtn,hide:true,callback:this.onPromptPromiseReject.bind(this)},{label:s.CopyFilesBtn,hide:true,color:"blue",defaultAction:true,callback:this.onPromptPromiseResove.bind(this)}]},onPromptPromiseResove:function e(){return this.resolvePromise(this.findView("FoldersSelect").serializeForm())}})},1753:function(e,t,i){"use strict";var s=i(1409);e.exports=s.extend({getQueryParams:function e(){return Object.assign({},this.attributes,{thumbsSize:"thumb",thumbsLimit:4})}})},1754:function(e,t,i){"use strict";var s=i(48);var r=i(549);var n=i(1698);e.exports=r.extend({name:"CreateFolder",initialize:function e(){var t=this;this.title=s.CreateFolderTitle;this.body=function(){return new n({model:t.model,submit:t.onSubmit.bind(t)})};this.footer=[{label:s.CancelBtn,hide:true,callback:this.onPromptPromiseReject.bind(this)},{label:s.CreateFolderBtn,color:"blue",defaultAction:true,callback:this.onSubmit.bind(this)}]},onSubmit:function e(){this.onPromptPromiseResove();this.hide()}})},1755:function(e,t,i){"use strict";var s=i(48);var r=i(546);var n=i(549);var a=i(1591);e.exports=n.extend({name:"MoveFiles",initialize:function e(){var t=this;this.title=this.tr("Move Selected Files");this.body=function(){return new r({className:"fav-modal",views:{"":[new r({tagName:"p",className:"modal__text modal__text_indent",template:function e(){return t.tr("Select a folder to move the selected files to")+":"}}),new a({app:t.app,className:"fav-modal__select fav-modal__select_rounded fav-modal__select_large",getActiveFolder:t.getActiveFolder,collection:t.folders,excludeActive:true,onlyEditable:true,isGranted:t.isGranted.bind(t)})]}})};this.footer=[{label:s.CancelBtn,hide:true,callback:this.onPromptPromiseReject.bind(this)},{label:this.tr("Move Files"),hide:true,color:"blue",defaultAction:true,callback:this.onPromptPromiseResove.bind(this)}]},onPromptPromiseResove:function e(){return this.resolvePromise(this.findView("FoldersSelect").serializeForm())}})},1756:function(e,t,i){"use strict";var s=i(48);var r=i(549);e.exports=r.extend({initialize:function e(){var t=this;for(var i=arguments.length,n=new Array(i),a=0;a<i;a++){n[a]=arguments[a]}r.prototype.initialize.apply(this,n);this.title=s.DeleteFilesTitle;this.message=this.tr(s.DeleteFilesMessage);this.footer=[{label:s.CancelBtn,hide:true,callback:function e(){return t.rejectPromise()}},{label:s.DeleteFilesBtn,color:"blue",hide:true,defaultAction:true,callback:function e(){return t.resolvePromise()}}]}})},1838:function(e,t,i){},1839:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<div class="'+i(t.className)+'"><span class="folders-select__selected-folder">';if(t.folder){s+='<i class="folders-select__selected-folder-icon">';if(t.folder.isOwn){s+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16"><path fill="#'+(t.folder.color||696969)+'" fill-rule="evenodd" d="M18 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2zm-4-8l-1-4-2 4H7l3 2-1 4 3-2 4 2-1-4 3-2z"/></svg>'}else{s+='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16"><path fill="#'+(t.folder.color||696969)+'" fill-rule="evenodd" d="M18 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h9a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2zm-3-5a1 1 0 0 1-1 0v-1a3 3 0 0 0 0-1 2 2 0 0 0 1-1V7a7 7 0 0 0 0-1 2 2 0 0 0-1-1 2 2 0 0 0 0-1 1 1 0 0 0-1 0 6 6 0 0 0-1 0 2 2 0 0 0-2 2 5 5 0 0 0 0 1v1a1 1 0 0 0 1 1 3 3 0 0 0 0 1v1a1 1 0 0 1-1 0l-2 2v1h9v-1l-2-2z" /></svg>'}s+='</i><span class="fav-panel__selected-folder-title">'+i(t.folder.title)+"</span>";if(!t.containersOnly){s+='<span class="fav-panel__selected-folder-counter">'+i(t.folder.count)+"</span>"}}else{s+='<i class="folders-select__selected-folder-icon icon-my-folders"></i><span class="fav-panel__selected-folder-title ';if(!t.emptyFolder.isShownCounter){s+="fav-panel__selected-folder-title_without-counter"}s+='">'+i(t.emptyFolder.title)+"</span>";if(t.emptyFolder.isShownCounter){s+='<span class="fav-panel__selected-folder-counter">0</span>'}}s+='</span><div class="folders-select__arrows-container"><i class="folders-select__arrows arrow arrow-black arrow-vertical"></i></div></div>';return s}},1840:function(e,t,i){"use strict";function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);if(t)s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));i.push.apply(i,s)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};if(t%2){s(Object(i),true).forEach((function(t){n(e,t,i[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(i))}else{s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}}return e}function n(e,t,i){if(t in e){Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true})}else{e[t]=i}return e}i(1841);var a=i(741);var o=i(1842);var l=i(989).default;var c=i(1843);var u=i(546);e.exports=u.extend({name:"FoldersSelectOptions",el:false,template:o,active:null,selected:null,folders:null,selectableGroup:false,events:{click:"onClick"},prepareRender:function e(){var t={app:this.app,name:"owner",active:this.active,selected:this.selected,folders:this.ownFolders,excludeActive:this.excludeActive,selectableGroup:this.selectableGroup,onSelect:this.onSelect.bind(this),isGranted:this.isGranted.bind(this),onGroupClickCallback:this.onGroupClickCallback.bind(this)};this.setViews({"._owner-group":new c(t),"._shared-group":new c(r({},t,{name:"shared",folders:this.sharedFolders}))})},clientAfterRender:function e(){var t=this;setTimeout((function(){return t.initPerfectScrollbar()}),0)},initPerfectScrollbar:function e(){var t=this.$("._list").get(0);a.initialize(t,l)},onClick:function e(t){t.stopPropagation()},onSelect:function e(){},onGroupClickCallback:function e(){}})},1841:function(e,t,i){},1842:function(e,t,i){"use strict";e.exports=function e(t){var i='<div class="select-folder"><div class="select-folder__list _list"><div class="_owner-group"></div><div class="_shared-group"></div></div></div>';return i}},1843:function(e,t,i){"use strict";var s=i(1844);var r=i(546);e.exports=r.extend({name:"FoldersSelectOptionsGroup",el:false,template:s,active:null,selected:null,folders:null,selectableGroup:false,events:{"click ._group":"onGroupClick","change ._folder-selection":"onFolderSelectionChange","click ._load":"handleLoadAllClick"},initialize:function e(){this.listenTo(this.folders,"update",this.render)},serialize:function e(){return{selected:this.selected?this.selected.get("id"):null,group:this.getGroupData()}},getGroupData:function e(){var t=this;var i={name:this.name,list:this.getFoldersWithColors(this.folders.serialize()),count:this.folders.getPager("totalItems"),hasNextPage:this.folders.pager.hasNextPage()};if(this.excludeActive){i.list=i.list.filter((function(e){return!t.active.includes(e.id)}))}return i},onFolderSelectionChange:function e(t){this.onSelect(t.currentTarget.value)},getFoldersWithColors:function e(t){return t.map((function(e){var t=e.preferences.find((function(e){return e.name==="folderViewColor"}));if(t){e.viewColor=t.value}return e}))},onGroupClick:function e(t){if(!this.selectableGroup){this.$(t.currentTarget).toggleClass("select-folder__part_closed")}this.onGroupClickCallback(t.currentTarget.dataset.group)},handleLoadAllClick:function e(t){this.folders.setPager({limit:this.folders.totalItems});this.$el.find("._load").addClass("loading")},onSelect:function e(){},onGroupClickCallback:function e(){}})},1844:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s="<div>";if(t.group.list.length){s+='<div class="select-folder__part _group" data-group="'+i(t.group.name)+'">';if(t.group.name==="shared"){s+='<i class="select-folder__part-icon icon icon-shared-folders"></i>'+this.tr("Shared With Me")}else{s+='<i class="select-folder__part-icon icon icon-my-folders"></i>'+this.tr("My Folders")}s+='<span class="select-folder__part-size">'+i(t.group.count)+"</span></div>"}s+='<div class="select-folder__sub-list">';var r=t.group.list;if(r){var n,a=-1,o=r.length-1;while(a<o){n=r[a+=1];if(n){s+='<label class="select-folder__item"><input class="select-folder__radio _folder-selection" type="radio" name="folder" value="'+i(n.id)+'"';if(t.selected===n.id){s+=' checked="checked"'}s+=" />";if(t.selected===n.id){s+='<i class="select-folder__icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 16"><path fill="';if(n.viewColor){s+="#"+i(n.viewColor)}else{s+="#969696"}s+='" fill-rule="evenodd" d="M17 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2zM14 5l-6 6-2-2-1 1 3 3 7-7z"/></svg></i>'}else{s+='<i class="select-folder__icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 16"><path fill="';if(n.viewColor){s+="#"+i(n.viewColor)}else{s+="#d2d2d2"}s+='" fill-rule="evenodd" d="M17 16H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 1l1 1h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2z"/></svg></i>'}s+='<span class="select-folder__text"><span class="select-folder__title">'+i(n.title)+'</span><span class="select-folder__counter">'+n.count+"</span></span>";if(t.group.name==="shared"){if(n.permission==="view"){s+='<i class="select-folder__badge icon icon-folder-action-view"></i>'}if(n.permission==="edit"){s+='<i class="select-folder__badge icon icon-folder-action-edit"></i>'}}else{if(n.isShared){s+='<i class="select-folder__badge icon icon-folder-action-share"></i>'}}s+="</label>"}}}if(t.group.hasNextPage){s+='<div class="select-folder__load-more _load"><i class="icon icon-load-more"></i><span>'+this.tr("Load all")+"</span></div>"}s+="</div></div>";return s}},1846:function(e,t,i){"use strict";var s=i(48);var r=i(549);e.exports=r.extend({name:"emptySelectionModal",title:s.ServiceModalTitle,message:function e(){return this.tr(s.SelectFolders)}})},1847:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<form class="modal__form"><label class="modal__form-field field-box field-box_light field-box_rounded field-box_large"><input class="input input-l _counter _field ';if(!t.title){s+="empty"}s+='" type="text"name="title" maxlength="50" value="'+i(t.title)+'"/><span class="field-box__title">'+this.tr("Folder name")+"</span></label></form>";return s}},1848:function(e,t,i){"use strict";var s=i(48);var r=i(549);var n=i(1698);e.exports=r.extend({name:"EditFolder",initialize:function e(){var t=this;this.title=s.EditFolderTitle;this.body=function(){return new n({model:t.model,submit:t.onSubmit.bind(t)})};this.footer=[{label:s.CancelBtn,hide:true,callback:this.onPromptPromiseReject.bind(this)},{label:s.SaveChangesBtn,hide:true,color:"blue",defaultAction:true,callback:this.onSubmit.bind(this)}]},onSubmit:function e(){this.onPromptPromiseResove();this.hide()}})},1849:function(e,t,i){"use strict";var s=i(48);var r=i(549);e.exports=r.extend({name:"DeleteFolder",initialize:function e(){var t=this;for(var i=arguments.length,n=new Array(i),a=0;a<i;a++){n[a]=arguments[a]}r.prototype.initialize.apply(this,n);this.title=s.DeleteFolder;this.message=function(){if(t.model instanceof Array){return t.tr("Do you really want to delete %s folders?",t.model.length)}var e=t.model.serialize(),i=e.title;return t.tr("Do you really want to delete this folder")+' "'+i+'"?'};this.footer=[{label:s.CancelBtn,hide:true,callback:this.onPromptPromiseReject.bind(this)},{label:s.DeleteFolder,hide:true,color:"blue",defaultAction:true,callback:this.onSubmit.bind(this)}]},onSubmit:function e(){this.resolvePromise();this.hide()}})},1850:function(e,t,i){"use strict";var s=i(1592);e.exports={isGranted:function e(t,i){var s=this;if(i===void 0){i=true}if(!["string","object"].includes(typeof t)){return false}var r=typeof t==="string"?t.split(" "):t;var n={auth:{rule:function e(){return s.app.user.isLoggedIn()},handler:function e(){return s.app.store.get("ModalsManager").show("SignupModal",{app:s.app,title:s.tr("Add to Favorites?")}).catch((function(){}))}},selection:{rule:function e(){return s.isAnySelected()},handler:function e(){return s.selectionHandler()}},edit:{rule:function e(){return s.canEditFolderOrFolders()},handler:function e(){return s.callModal("NeedPermission",{app:s.app}).show()}},remove:{rule:function e(){return s.hasPermissionsTo("delete")},handler:function e(){return s.callModal("NeedPermission",{app:s.app}).show()}},changeFiles:{rule:function e(){return s.hasPermissionsTo("changeFiles")},handler:function e(){return s.callModal("NeedPermission").show()}}};return r.every((function(e){var t=n[e]&&n[e].rule();if(!t&&i){n[e].handler()}return t}))},isAnySelected:function e(){return this.state.isFilesMode()?this.getSelectedFiles().length>0:this.getSelectedFolders().length>0},selectionHandler:function e(){return this.state.isFilesMode()?this.callModal("EmptySelectionFiles").show():s.callModal("EmptySelectionFolders",{app:this.app}).show()},canEditFolderOrFolders:function e(){if(this.state.isFilesMode()){var t=this.getActiveFolder();return t&&t.get("permission")==="edit"}var i=this.getSelectedFolders();return i.length&&i.every((function(e){return e.get("permission")==="edit"}))},hasPermissionsTo:function e(t){if(this.state.isFilesMode()){var i=this.getActiveFolder();return i&&i.hasAction(t)}var s=this.getSelectedFolders();return s.length&&s.every((function(e){return e.hasAction(t)}))}}},1856:function(e,t,i){"use strict";var s=i(48),r=s.ServiceModalTitle;var n=i(549);e.exports=n.extend({name:"needPermissionModal",title:r,message:function e(){return this.tr("Sorry, you have no editing permissions.")}})},1857:function(e,t,i){"use strict";var s=i(48);var r=i(549);e.exports=r.extend({name:"emptySelectionModal",title:s.ServiceModalTitle,message:function e(){return this.tr(s.EmptySelectionMessageFiles)}})},1858:function(e,t,i){"use strict";var s=i(2);e.exports=s.extend({defaults:{open:false,editor:false,folderID:null,thumbs:"normal",liftLevel:2},isFilesMode:function e(){return!["owner","shared"].includes(this.get("folderID"))},isEmptyFoldersMode:function e(){return!this.get("folderID")},wasFoldersMode:function e(){return["owner","shared"].includes(this.previous("folderID"))},getFoldersGroupTitle:function e(t){if(t===void 0){t=this.get("folderID")}var i={owner:this.app.tr("My Folders"),shared:this.app.tr("Shared With Me")};return i[t]},getFoldersGroupPermissions:function e(t){if(t===void 0){t=this.get("folderID")}var i={owner:["owner"],shared:["edit","view"]};return i[t]}})},2695:function(e,t,i){"use strict";var s=r(i(553));function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t,i,s,r,n,a){try{var o=e[n](a);var l=o.value}catch(c){i(c);return}if(o.done){t(l)}else{Promise.resolve(l).then(s,r)}}function a(e){return function(){var t=this,i=arguments;return new Promise((function(s,r){var a=e.apply(t,i);function o(e){n(a,s,r,o,l,"next",e)}function l(e){n(a,s,r,o,l,"throw",e)}o(undefined)}))}}function o(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);if(t)s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}));i.push.apply(i,s)}return i}function l(e){for(var t=1;t<arguments.length;t++){var i=arguments[t]!=null?arguments[t]:{};if(t%2){o(Object(i),true).forEach((function(t){c(e,t,i[t])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(e,Object.getOwnPropertyDescriptors(i))}else{o(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}}return e}function c(e,t,i){if(t in e){Object.defineProperty(e,t,{value:i,enumerable:true,configurable:true,writable:true})}else{e[t]=i}return e}i(2696);i(1072);var u=i(0);var d=i(546);var h=i(2697);var f=i(1753);var p=i(1697);var v=i(2701);var m=i(1356);var g=i(2702);var b=i(28);var _=i(1858);var y=i(1857);var w=i(2704);var F=i(1856);var k=i(1754);var C=i(1699);var x=i(1755);var P=i(1756);var S=i(1592);var T=i(1850);var I=i(74);var A=i(2031);var M="10_lbpSettings";var O="10_currentLevel";var E="nonAuthFavFileAdding";var D={page:1,limit:60};var L={EmptySelectionFiles:y,CopyFiles:C,MoveFiles:x,DeleteFiles:P,SelectFolder:w,CreateFolder:k,NeedPermission:F};var R={chunkName:"chunk_fav_panel_opened",promiseCb:function e(t,s){return Promise.all([i.e(4),i.e(130),i.e(114)]).then(function(e){var s=i(2802);t(s)}.bind(null,i)).catch(s)}};e.exports=d.extend(l({},T,{name:"FavoritesPanel",tagName:"div",className:"fav-panel-box",webSocketClient:null,initialStateOverrides:{},FavoritesPanelOpened:null,initialize:function e(){var t=this;this.state=new _(this.getInitialState(),{app:this.app});this.activeFolder=new f({},{app:this.app});this.activeFolder.getQueryParams=function(){return l({},t.activeFolder.serialize(),{id:t.state.get("folderID")})};this.folders=new p([],{app:this.app,endless:true,pager:D,filters:{permission:this.state.getFoldersGroupPermissions(),thumbsSize:"thumb",thumbsLimit:1}});this.permissions=new m([],{app:this.app});this.cache=new v([],{app:this.app});this.collection=new g([],{app:this.app,pager:D,filters:{id:null},endless:true});this.selectedByContextMenu=new b([],{app:this.app});this.app.store.link("FolderCache",this.cache);this.app.store.link("FolderState",this.state);this.listenTo(this.state,"change:folderID",this.onStateFolderIdChange);this.listenTo(this.collection,"update",this.actualizeCache);this.listenTo(this.cache,"reset update",this.folderCacheUpdateCallback);this.listenTo(this.folders,{update:this.handleFoldersUpdate});this.listenTo(this.app.observer,{"Favorites:OpenPanel":this.openPanel,"Favorites:ToggleFile":this.toggleFile,"Favorites:TogglePanel":this.togglePanel});if(this.shouldFetchComponentsForOpenState()){this.fetchComponentsForOpenState().then((function(){return t.render()}))}if(!this.isGranted("auth",false)){return}if(!this.state.get("folderID")){this.tryPlaceFirstFolderAsActive()}this.onStateFolderIdChange()},prepareRender:function e(){var t=this;if(this.shouldFetchComponentsForOpenState()){return false}this.setViews({"":this.state.get("open")?new this.FavoritesPanelOpened({app:this.app,state:this.state,cache:this.cache,collection:this.collection,folders:this.folders,permissions:this.permissions,activeFolder:this.activeFolder,selectedByContextMenu:this.selectedByContextMenu,isGranted:this.isGranted.bind(this),togglePanel:this.togglePanel.bind(this),callModal:this.callModal.bind(this),getActiveFolder:this.getActiveFolder.bind(this),isActiveFolderExist:this.isActiveFolderExist.bind(this),addFile:this.addFile.bind(this),deleteFile:this.deleteFile.bind(this),getSelectedFiles:this.getSelectedFiles.bind(this),getSelectedFolders:this.getSelectedFolders.bind(this),autoCreateFolder:this.autoCreateFolder.bind(this),updatePanelState:this.updatePanelState.bind(this),getWebSocketClient:function e(){return t.webSocketClient},setWebSocketClient:function e(i){t.webSocketClient=i},fetchFolders:this.fetchFolders.bind(this),fetchPermissions:this.fetchPermissions.bind(this),fetchCache:this.fetchCache.bind(this),fetchFolderDependencies:this.fetchFolderDependencies.bind(this)}):new h({app:this.app,state:this.state,collection:this.collection,openPanel:this.openPanel.bind(this),getActiveFolder:this.getActiveFolder.bind(this)})});return true},getInitialState:function e(){var t=this.app.userSettings.get("FavoritesPanel");return l({},t,{},this.initialStateOverrides)},resetPanelToEmptyState:function e(){this.updatePanelState({folderID:null});this.collection.reset();this.cache.reset();this.checkFileToAddQueue()},handleFoldersUpdate:function e(t,i){var s=i.created,r=i.reset;if(t.isEmpty()){this.resetPanelToEmptyState();return}if(s){this.updatePanelState({folderID:t.first().get("id")})}},actualizeCache:function e(t,i){var s=i.changes,r=i.at;if(s){var n=s.added.map((function(e){return{id:e.get("id")}}));var a=s.removed.map((function(e){return e.get("id")}));this.cache.add(n,{at:r,silent:true});this.cache.remove(a,{silent:true});this.cache.trigger("update",this.cache,{changes:s,at:r,refetch:true})}},getSelectedFiles:function e(){return this.cache.where({selected:true})},getSelectedFolders:function e(){return this.folders.where({selected:true}).concat(this.selectedByContextMenu.models)},fetchFolders:function e(t,i){var s=this.state.getFoldersGroupPermissions();if(!s){var r=this.getActiveFolder();var n=r.get("userId")!==this.app.user.get("id")?"shared":"owner";s=this.state.getFoldersGroupPermissions(n)}this.folders.setFilters({permission:s});this.folders.fetchPage(t,i)},innerAddFile:function e(t,i){var s=this;if(i===void 0){i=0}if(this.isActiveFolderExist()){this.collection.addFile(t,this.getActiveFolder().get("id"),i)}else{this.autoCreateFolder().then((function(){return s.collection.addFile(t,s.state.get("folderID"),i)}))}},innerDeleteFile:function e(t){var i=this;var s=[t];var r=this.cache.indexOf(this.cache.get(t));this.collection.delete({lightbox:this.state.get("folderID"),items:[t],positions:[r]}).then((function(){i.cache.remove(s)}))},toggleFile:u.throttle((function(e){if(this.folders.length&&!this.state.isFilesMode()){this.openPanel();this.callModal("SelectFolder").show();return}if(this.isActiveFolderExist()&&!this.isGranted("changeFiles",false)){this.callModal("NeedPermission").show();return}var t=e.id|0;if(this.cache.get(t)){this.deleteFile(t)}else{this.addFile(t)}}),400),deleteFile:function e(){if(this.isGranted("auth changeFiles")){this.innerDeleteFile.apply(this,arguments)}},addFile:function e(t,i){if(!t){return}if(this.isGranted("auth changeFiles")){this.app.store.unlink("FileForFavorite");this.innerAddFile(t,i)}else{this.updateCookieState({key:E,value:t})}},callModal:function e(t,i){return this.insertView(t,new L[t](Object.assign({app:this.app,destroyOnHide:true},i)))},updatePanelState:function e(t){this.state.set(t);this.app.userSettings.set({FavoritesPanel:this.state.toJSON()});this.updateCookieState()},updateCookieState:function e(t){var i={expires:"1Y"};if(t){I.set(t.key,t.value,i)}else{var s=u.omit(this.state.attributes,["open","folderID","liftLevel"]);s.visible=this.state.get("open");s.lightbox=this.state.get("folderID");s.thumbs=s.thumbs==="big"?"medium":"small";I.set(M,JSON.stringify(s),i);I.set(O,this.state.get("liftLevel"),i)}},getActiveFolder:function e(){return this.activeFolder},isActiveFolderExist:function e(){return this.activeFolder.get("id")},autoCreateFolder:function e(){return S.createFolder(this.app,this.folders)},checkFileToAddQueue:function e(){var t=I.get(E);if(t&&t!=="null"){this.updateCookieState({key:E,value:null});this.openPanel();this.innerAddFile(+t)}},openPanel:function e(){if(!this.state.get("open")){this.togglePanel()}},togglePanel:function(){var e=a(s.default.mark((function e(){return s.default.wrap((function e(t){while(1){switch(t.prev=t.next){case 0:this.updatePanelState({open:!this.state.get("open")});if(!this.shouldFetchComponentsForOpenState()){t.next=4;break}t.next=4;return this.fetchComponentsForOpenState();case 4:this.render();case 5:case"end":return t.stop()}}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),folderCacheUpdateCallback:function e(t,i){if(!this.isActiveFolderExist()){return}var s=this.getActiveFolder();s.set({count:t.length},{observable:true});this.app.observer.fire("Favorites:PanelCacheUpdate",{folderId:this.state.get("folderID"),options:i})},onStateFolderIdChange:function e(){var t=this;if(this.state.isFilesMode()){this.activeFolder.fetch().then((function(){t.updatePanelComponents();t.fetchFolderDependencies(t.state.wasFoldersMode())})).fail((function(){return t.resetPanelToEmptyState()}));this.folders.reset()}else{this.activeFolder.set(this.activeFolder.defaults);this.cache.reset();this.collection.reset();this.fetchFolders(1,{reset:true});this.updatePanelComponents()}},fetchFolderDependencies:function e(t){if(!this.isActiveFolderExist()){return}var i=this.state.get("folderID")!==this.collection.getFilters("id");if(t||i){this.fetchPermissions();this.fetchCache();this.fetchFiles()}},fetchPermissions:function e(){this.permissions.getQueryParams={folderId:this.state.get("folderID")};this.permissions.fetch({reset:true})},fetchCache:function e(){var t=this.getActiveFolder();this.cache.getQueryParams={id:t.get("id")};this.cache.fetch({reset:true})},fetchFiles:function e(){this.$("._scroll").scrollTop(0);this.collection.setFilters({id:this.state.get("folderID")});this.collection.fetchPage(1,{reset:true})},tryPlaceFirstFolderAsActive:function e(){var t=this;this.folders.fetch().then((function(){var e=t.folders.first();t.updatePanelState({folderID:e?e.get("id"):null})})).fail((function(){return t.resetPanelToEmptyState()}))},shouldFetchComponentsForOpenState:function e(){return this.state.get("open")&&this.FavoritesPanelOpened===null},fetchComponentsForOpenState:function(){var e=a(s.default.mark((function e(){return s.default.wrap((function e(t){while(1){switch(t.prev=t.next){case 0:t.next=2;return A.factory({app:this.app,config:R});case 2:this.FavoritesPanelOpened=t.sent;case 3:case"end":return t.stop()}}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),updatePanelComponents:function e(){var t=this.findView("FavoritesPanelContent");if(t){t.render()}}}))},2696:function(e,t,i){},2697:function(e,t,i){"use strict";var s=i(2698);var r=i(546);var n=i(2699);e.exports=r.extend({name:"FavoritesPanelClosed",template:s,events:{"click ._pull":"handlePullerClick"},prepareRender:function e(){this.setViews({"._msg-box":new n({app:this.app,state:this.state,collection:this.collection,openPanelCallback:this.openPanel.bind(this),getActiveFolder:this.getActiveFolder.bind(this)})})},handlePullerClick:function e(t){this.openPanel()},openPanel:function e(){},getActiveFolder:function e(){}})},2698:function(e,t,i){"use strict";e.exports=function e(t){var i='<div class="fav-panel-closed"> <div class="fav-panel-msg-box _msg-box"></div> <div class="fav-panel fav-panel_closed _pull"> <div class="fav-panel__row"> <div class="fav-panel__cell"> <div class="fav-panel__shadow"></div> </div> <div class="fav-panel__cell fav-panel__cell_middle"> <div class="fav-panel__tab-wrapper"> <div class="fav-panel__tab"> <span class="fav-panel__tab-title"> <i class="fav-panel__tab-icon icon icon-favorites"></i> '+this.tr("Favorites")+' </span> <div class="fav-panel__tab-shadow"></div> </div> </div> </div> <div class="fav-panel__cell"> <div class="fav-panel__shadow"></div> </div> </div> <div class="fav-panel__row"> <div class="fav-panel__cell"> <div class="fav-panel__bg"></div> </div> <div class="fav-panel__cell fav-panel__cell_middle"> <div class="fav-panel__bg"></div> </div> <div class="fav-panel__cell"> <div class="fav-panel__bg"></div> </div> </div> </div></div>';return i}},2699:function(e,t,i){"use strict";var s=i(2700);var r=i(546);var n=i(2);var a=100;var o=3e3;var l=200;e.exports=r.extend({name:"FavoritesMessage",el:false,template:s,count:1,timer:null,events:{"click ._open":"onOpenClick","click ._close-msg":"onCloseMsgClick"},initialize:function e(){this.messageModel=new n({showed:false,thumb:null,count:1});this.listenTo(this.app.observer,"Favorites:fileAdded",this.fileAdded);this.listenTo(this.messageModel,"change:thumb",this.render)},serialize:function e(){return{showed:this.messageModel.get("showed"),count:Math.min(this.messageModel.get("count"),3),prevCount:Math.min(this.messageModel.get("count")-1,3),folderThumb:this.messageModel.get("thumb"),folderPreviousThumb:this.messageModel.previous("thumb"),folderName:this.getFolderName()}},clientAfterRender:function e(){var t=this;if(this.messageModel.get("showed")){setTimeout((function(){return t.show()}),a)}},getFolderName:function e(){var t=this.getActiveFolder();return t?t.get("title"):""},fileAdded:function e(t){if(!this.state.get("open")&&this.collection.get(t.id)){var i=this.messageModel.get("count");if(this.messageModel.get("showed")){i+=1}else{i=1}this.messageModel.set({showed:true,thumb:this.collection.get(t.id).makeThumb("normal"),count:i})}},show:function e(){var t=this;clearTimeout(this.timer);this.$el.addClass("fav-msg_visible");this.$("._img").removeClass("fav-msg__img_hidden");setTimeout((function(){return t.$("._img-box").addClass("fav-msg__img-box_count"+t.messageModel.get("count"))}),l);this.timer=setTimeout((function(){return t.hide()}),o)},hide:function e(){var t=this;this.$el.removeClass("fav-msg_visible");setTimeout((function(){return t.messageModel.set({showed:false,count:1,thumb:null})}),l)},onOpenClick:function e(){this.openPanelCallback();this.hide()},onCloseMsgClick:function e(t){t.stopPropagation();clearTimeout(this.timer);this.hide()},openPanelCallback:function e(){}})},2700:function(e,t,i){"use strict";e.exports=function e(t){var i=typeof _encodeHTML!=="undefined"?_encodeHTML:function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},i=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return(e==null?"":""+e).replace(i,(function(e){return t[e]||e}))}}();var s='<div class="fav-msg';if(t.showed&&t.count>1){s+=" fav-msg_visible"}s+='"><div class="fav-msg__wrap _open"><div class="fav-msg__img-box fav-msg__img-box_count'+t.prevCount+' _img-box"><div class="fav-msg__img';if(t.folderPreviousThumb){s+=" fav-msg__img_hidden"}s+=' _img"';if(t.folderThumb){s+=' style="background-image: url('+i(t.folderThumb)+');"'}s+="></div>";if(t.folderPreviousThumb){s+='<div class="fav-msg__img fav-msg__img_prev" style="background-image: url('+i(t.folderPreviousThumb)+');"></div><div class="fav-msg__img fav-msg__img_back"></div>'}s+='</div><span class="fav-msg__text">'+this.tr("Added to <b>%s</b>",t.folderName)+'</span><div class="fav-msg__close _close-msg"><i class="fav-msg__icon icon icon-close-small-white"></i></div><i class="fav-msg__pointer"></i></div></div>';return s}},2701:function(e,t,i){"use strict";var s=i(2);var r=i(28);e.exports=r.extend({url:"FolderCache",model:s.extend({defaults:{id:null,selected:false},parse:function e(t){return{id:parseInt(t,10)}}}),reorder:function e(t,i){var s=this;return this.sync("update",this,{getQueryParams:Object.assign({},this.getQueryParams,{fileId:t,index:i}),success:function e(){return s.trigger("sync",s)}}).promise()},getSelected:function e(){return this.where({selected:true})},getSelectedIds:function e(){return this.getSelected().map((function(e){return e.id}))}})},2702:function(e,t,i){"use strict";(function(e){var t=i(0);var s=i(1044);var r=i(2703);var n=i(9),a=n.getLogger;var o=a(e);e.exports=s.extend({url:"FavoriteFiles",model:r,parse:function e(t){if(t instanceof Array){return t}var i=t.count,s=t.items,r=s===void 0?[]:s;this.totalItems=Math.max(parseInt(i,10),0);return r},addFile:function e(i,s,n){var a=this;var l=new r({id:i},{app:this.app});this.listenToOnce(l,"sync",(function(e,s){if(!s.errors){a.add(e,{at:n});a.app.observer.fire("Favorites:fileAdded",{id:i})}else{o.error("FavoriteFiles: "+t.pluck(s.errors,"error_message").join(". "))}}));return l.save({},{wait:true,getQueryParams:{id:i,folder:s,at:n}}).promise()},copy:function e(t){var i=this;return this.sync("update",this,{url:"FavoriteFilesCopy",getQueryParams:t,success:function e(){return i.trigger("sync",i,{})}})},move:function e(t){var i=this;return this.sync("update",this,{url:"FavoriteFilesMove",getQueryParams:t,success:function e(){i.trigger("sync",i,{});i.remove(t.items)}})},delete:function e(t){var i=this;return this.sync("update",this,{url:"FavoriteFilesRemove",getQueryParams:t,success:function e(){i.trigger("sync",i,{});i.remove(t.items)}})}})}).call(this,i(5)(e))},2703:function(e,t,i){"use strict";var s=i(0);var r=i(117);e.exports=r.extend({url:"FavoriteFile",getQueryParams:s.noop,parse:function e(t,i){if(t.errors){this.trigger("invalid",this,t.errors);return{}}var n=t.items?s.first(t.items):t;return r.prototype.parse.call(this,n,i)}})},2704:function(e,t,i){"use strict";var s=i(549);e.exports=s.extend({name:"SelectFolderModal",initialize:function e(){var t=this;s.prototype.initialize.apply(this);this.title=this.tr("Select a Folder");this.message=function(){return t.tr("Please select a folder in your Favorites to add the selected file to.")}}})},578:function(e,t,i){"use strict";var s=i(0);var r=i(546);var n=i(28);var a=i(11);var o=10;var l="none";var c=100;var u=300;var d=16;e.exports=r.extend({name:"Tabs",el:false,schema:[],subSchema:[],preventDefaultAction:false,urlLessTabs:false,menuUnderline:false,classNames:"",active:"",subActive:"",serializeData:{},events:{"click ._tab":"onTabClick","mouseenter ._tab":"onTabMouseEnter","mouseleave ._tab":"onTabMouseLeave","touchend ._scroll":"onScrollTouchEnd","click ._nav-left":"onNavLeftClick","click ._nav-right":"onNavRightClick"},globals:{"resize window":"onWindowResize"},initialize:function e(){this.schema=new n(s.result(this,"schema"));this.defineActiveTab();this.subSchema=new n(s.result(this,"subSchema"));this.prepareSubTabs();this.listenTo(this.schema,"change update",this.render)},serialize:function e(){return Object.assign({},{classNames:this.classNames,urlLessTabs:this.urlLessTabs,scheme:this.getEnabled().map((function(e){return e.serialize()})),subScheme:this.subSchema.serialize(),isRendered:this.isRendered},this.serializeData)},clientAfterRender:function e(){if(this.menuUnderline){this.setDefaultMenuUnderline()}if(this.isScrollPositionSet){this.setScrollPosition();this.$("._scroll").removeClass("invisible")}this.updateNavigation();this.isRendered=true},onWindowResize:s.throttle((function(){if(this.menuUnderline){this.setDefaultMenuUnderline()}if(this.isScrollPositionSet){this.setScrollPosition()}this.updateNavigation()}),o),onTabClick:function e(t){var i=t.currentTarget.dataset.key;var s=this.schema.findWhere({key:i});if(s&&s.get("onClick")){s.get("onClick").call(null,t);return}var r;if(this.preventDefaultAction||s&&s.get("toggler")||s&&s.get("active")||s&&s.get("isDefault")===true&&this.schema.findWhere({toggler:true,active:true})){t.preventDefault()}if(s&&s.get("toggler")&&s.get("active")){i=this.schema.findWhere({isDefault:true}).get("key");r=s.get("key")}if(s&&s.get("target")!=="_blank"){this.setActiveTab(i,r)}},onTabMouseEnter:function e(t){if(!this.menuUnderline){return}var i=this.$(t.currentTarget);var s=i.offset().left-this.$el.offset().left;this.menuUnderlinePosition(s,i.outerWidth())},onTabMouseLeave:function e(){if(this.schema.where({active:true}).length>0){var t=this.schema.findWhere({pseudoActive:true});if(t){t.set({pseudoActive:false})}}if(this.menuUnderline){this.setDefaultMenuUnderline()}},onScrollTouchEnd:function e(){this.updateNavigation()},onNavLeftClick:function e(){var t=this;var i=this.$("._scroll").scrollLeft();this.$("._scroll").animate({scrollLeft:Math.max(i-c,0)},u,(function(){return t.updateNavigation()}))},onNavRightClick:function e(){var t=this;var i=this.$("._scroll").scrollLeft();this.$("._scroll").animate({scrollLeft:i+c},u,(function(){return t.updateNavigation()}))},updateNavigation:function e(){var t=this.$("._scroll");if(t.length===0){return}var i=this.$("._tab:last");var s=i.offset().left+i.width()-d;this.$("._nav-left").toggleClass("active",t.scrollLeft()>d);this.$("._nav-right").toggleClass("active",s>t.width())},setDefaultMenuUnderline:function e(){var t=this.$("._tab-active");var i=t.offset().left-this.$el.offset().left;this.menuUnderlinePosition(i,t.outerWidth())},menuUnderlinePosition:function e(t,i){this.$("._menu-underline").css({left:t,width:i}).removeClass("hidden")},setScrollPosition:function e(){var t=this.$("._active");if(t.length===0){return}var i=t.offset().left;if(i+t.outerWidth()>window.innerWidth){this.$("._scroll").scrollLeft(i)}},defineActiveTab:function e(){var t=this;this.schema.each((function(e){var i=e.get("active")!=null?e.get("active"):t.defineTabActivityByProperty(e);if(t.active===l){i=false}e.set({url:t.app.makeUrl(e.get("urlKey")||e.get("key")||""),active:i!=null?i:t.defineTabByUrl(e),enabled:s.isUndefined(e.get("enabled"))||e.get("enabled")===true||s.isFunction(e.get("enabled"))&&e.get("enabled")(t.app.user)})}));if(this.shouldForceSetActive()){var i=this.schema.findWhere({isDefault:true})||this.schema.first();if(i){this.setActiveTab(i.get("key"),undefined,{silent:true})}}},shouldForceSetActive:function e(){return this.active!==l&&(!this.getActiveTab()||!this.getActiveTab().get("enabled"))},prepareSubTabs:function e(){var t=this;this.subSchema.each((function(e){return e.set({url:t.app.makeUrl(e.get("urlKey")||e.get("key")||""),active:e.get("key")===t.subActive,enabled:s.isUndefined(e.get("enabled"))||e.get("enabled")===true||s.isFunction(e.get("enabled"))&&e.get("enabled")(t.app.user)})}))},defineTabActivityByProperty:function e(t){return this.active&&this.active.length?t.get("key")===this.active:null},defineTabByUrl:function e(t){var i=this.app.makeUrl(t.get("key"));return!!i&&(this.app.parsedUrl.pathname===i||!t.get("isDefault")&&a.isBelongTo(i+"/",this.app.parsedUrl.pathname+"/"))},reset:function e(t){this.setActiveTab(t||this.schema.first().get("key"))},setActiveTab:function e(t,i,s){if(this.schema.findWhere({key:t}).get("active")){return}if(this.getActiveTab()){this.getActiveTab().set({active:false})}this.schema.findWhere({key:t}).set({active:true});if(i){this.schema.findWhere({key:i}).set({pseudoActive:true})}if(!s||!s.silent){this.changeTabCallback(this.getActiveTab())}},getActiveTab:function e(){return this.schema.findWhere({active:true})},getActiveTabIndex:function e(){return this.schema.indexOf(this.getActiveTab())},getEnabled:function e(){return this.schema.where({enabled:true})},changeTabCallback:function e(){}})},823:function(e,t,i){"use strict";var s=i(4),r=s.languages;var n=r.accepts;e.exports={ContactBox:function e(t){return{stats:["image","editorial","video"]}},OurApps:function e(t){return{isEnabled:t.lang!==n.zh}},About:function e(t){return{socialLinksEnabled:t.lang!==n.zh}},FileViewThumb:function e(t){return{isSharingEnabled:t.lang!==n.zh}},ShareFolder:function e(t){return{socialTabEnabled:t.lang!==n.zh}},SearchHeaderFolder:function e(t){return{isSharingEnabled:t.user.isLoggedIn()||t.lang!==n.zh}},FileViewModals:function e(t){return{shouldHideTitle:t.features.isFeatureOnValue("NoTitleModal")}}}},828:function(e,t,i){"use strict";var s=i(0);var r=i(890);var n=i(1070);var a=r.Model.extend({constructor:function e(t,i){if(i===void 0){i={}}this.app=i.app||i.collection&&i.collection.app;this.on({request:this.onRequest,sync:this.onSync,error:this.onError});r.Model.call(this,t,i)},getQueryParams:function e(){return s.clone(this.attributes)},exportSettings:function e(t){return t?s.pick(this.attributes,t):s.clone(this.attributes)},importSettings:function e(){},isBulkAllowed:function e(){return true},clone:function e(t){return new this.constructor(this.attributes,t)},onRequest:function e(){this.pending=true},onSync:function e(t,i,s){this.pending=false;if(i.errors){this.trigger("error",t,i,s)}},onError:function e(){this.pending=false},secureSet:function e(t,i,r){if(t===null){return false}var n;var a=r;if(typeof t==="object"){n=t;a=i}else{(n={})[t]=i}var o=s.pick(n,s.intersection(s.keys(n),s.keys(this.attributes)));if(s.isEmpty(o)){return false}return this.set(o,Object.assign(a||{},{validate:true}))},secureSetParsed:function e(t){return this.secureSet(this.parse(t))},resetToDefaults:function e(t,i){var r=t?s.pick(this.defaults,t):this.defaults;return this.set(r,i)},getNonDefaults:function e(t){var i=this;var r=t?s.pick(this.attributes,t):this.attributes;var n={};s.each(r,(function(e,t){if(!s.isEqual(i.defaults[t],e)){n[t]=e}}));return n},hasChangedExcept:function e(t){var i=s.isArray(t)?t:[t];return s.size(s.omit(this.hasChanged(),i))>0},serialize:function e(){return s.clone(this.attributes)},toAPI:function e(){return{}}});Object.assign(a.prototype,n.mixin);e.exports=a},890:function(e,t,i){"use strict";var s=i(17);s.oldSync=s.oldSync||s.sync;s.sync=function(e,t,i){if(!t.getQueryParams&&!i.getQueryParams||t.oldSync){return s.oldSync.call(this,e,t,i)}if(!t.app){if(typeof window==="undefined"||!window.app){throw new Error('Model\'s "app" object is not defined')}t.app=window.app}return t.app.fetcher.request(e,t,i)};e.exports=s},989:function(e,t,i){"use strict";e.exports.default={suppressScrollX:true,wheelSpeed:.6,minScrollbarLength:30}}}]);